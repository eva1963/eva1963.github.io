---
title: 定时器和异步编程
date: 2017-05-12 21:11:36
categories: JS
tags: js,setTimeout,同步，异步
---
#### 定时器： 设定一个定时器，并且设定了等到的时候，当到达设定的时间，浏览器执行对应的方法
[function]： 到达时间后执行的方法---设置定时器的时候方法没有执行，到时间浏览器才帮我们执行
[interval]： 时间因子（需要等待的时间MS毫秒）
`setTimeout([function],(interval))`
> 执行一次的定时器

`setInterval([function],(interval))`
> 可执行多次的定时器

- 清除定时器：
clearInterval/clearTimeout：这两个方法中的任何一个都可以清楚用任何方法创建的定时器,根据序号清楚浏览器中设定的定时器
设置定时器会有一个返回值这个值是一个数字，属于定时器的编号代表当前设置的是第几个定时器，不管是基于setTimeout还是setInterval创建的定时器，这个编号（是唯一的）会接着累加;

- js中的同步编程和异步编程：
同步编程：任务是按照顺序依次处理，当前事件没有完成下一个事件无法执行（循环for...都是同步的）
异步编程： 当期那这件事没有彻底做完，需要等待一段时间，此时我们不等，继续执行下面的任务，当下面的任务完成了，再去把没有彻底完成的事情完成
    1. 所有的时间绑定都是异步的
    2. 所有的定时器都是异步的
    3. JAXA中一般都是用异步编程处理
    4. 回调函数也算是异步编程

##### 定时器设定一个时间，到达时间后不一定执行，比如遇到了死循环，他设定的时间是一个最小时间，如果当前还有其他的同步任务需要执行，那么它还是需要等着
```
let n = 0;
setTimeout(()=>{
    n++;
    console.log(n);
}, 1000)
console.log(n);
while(1===1) {
    //死循环
}
```

#### 浏览器是如何规划同步异步机制的
1. `浏览器是多线程的，JS是单线程的，`（浏览器只给JS分配一个线程）且单线程一次只能处理一件事情
进程：每一个应用程序都可以理解为一个进程（浏览器打开一个页面就相当于开了一个进程），在一个进程中我们经常会同时做很多事，此时我们可以分配多个线程去同时完成

2. JS在单线程当中实现异步的机制主要依赖于浏览器的任务队列完成的，浏览器中有两个任务队列，`主任务队列`和`等待任务队列`；

**异步编程的原理：**
单线程的机制模拟出多线程的效果
> 在主任务队列自上而下执行的时候，如果遇到一个异步操作任务，没有立即执行，而是把它放到等待任务里面排队
> 
> 当主任务完成后才会去等待任务里面去查找，如果主任务队列完不成，不管等待任务队列中是否有到达时间的，都不处理，继续等待主任务队列完成，因为JS是单线程的一次只能处理一个事情
> 
> 等待任务队列当中，谁达到条件了（如果都达到条件了，谁先达到的就先处理谁），就把这个任务重新放到主任务队列中执行，把这个执行完才能去等待中找下一个...
