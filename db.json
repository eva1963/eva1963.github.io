{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"themes/huno/source/css/animate.css","path":"css/animate.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/archive.css","path":"css/archive.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/china-social-icon.css","path":"css/china-social-icon.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/highlight.styl","path":"css/highlight.styl","modified":1,"renderable":1},{"_id":"themes/huno/source/css/uno.css","path":"css/uno.css","modified":1,"renderable":1},{"_id":"themes/huno/source/images/totop.png","path":"images/totop.png","modified":1,"renderable":1},{"_id":"themes/huno/source/js/awesome-toc.min.js","path":"js/awesome-toc.min.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/jquery.githubRepoWidget.min.js","path":"js/jquery.githubRepoWidget.min.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/scale.fix.js","path":"js/scale.fix.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/jquery.min.js","path":"js/jquery.min.js","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.svg","path":"fonts/china-social/china-social.svg","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.woff","path":"fonts/china-social/china-social.woff","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.eot","path":"fonts/china-social/china-social.eot","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.ttf","path":"fonts/china-social/china-social.ttf","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/readme.html","path":"fonts/china-social/readme.html","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.eot","path":"fonts/foundation-icons/foundation-icons.eot","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.css","path":"fonts/foundation-icons/foundation-icons.css","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.woff","path":"fonts/foundation-icons/foundation-icons.woff","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.ttf","path":"fonts/foundation-icons/foundation-icons.ttf","modified":1,"renderable":1},{"_id":"themes/huno/source/images/background-cover11.jpg","path":"images/background-cover11.jpg","modified":1,"renderable":1},{"_id":"themes/huno/source/images/avatar.jpg","path":"images/avatar.jpg","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.svg","path":"fonts/foundation-icons/foundation-icons.svg","modified":1,"renderable":1},{"_id":"themes/huno/source/images/background-cover.jpg","path":"images/background-cover.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"8b80b6b373f1019bf01439b7fb9d77c9c5169c35","modified":1474357119000},{"_id":"source/CNAME","hash":"df61cb1e81f46bd9de367c07460268a4ee030845","modified":1474269773000},{"_id":"themes/huno/.DS_Store","hash":"cef006ea59b15c431e1f99110a6f312a817747ef","modified":1474353430000},{"_id":"themes/huno/README.md","hash":"8940f32e649ba30b684f347c04826a066fa9f399","modified":1474253725000},{"_id":"themes/huno/_config.yml","hash":"88a1be3ec486f241995795cfb8329fccc7d6bd4a","modified":1474267055000},{"_id":"themes/huno/README.en.md","hash":"0878f26ed7fd9d4cbfeb0ddab5e1e14c93be793a","modified":1474190789000},{"_id":"source/_posts/.DS_Store","hash":"fc1bfedde790fa86adcb23d3355606dc6ac255b4","modified":1474357051000},{"_id":"source/#blog/.DS_Store","hash":"1afe86903f9e2975d9553458d279ea4fb98330b4","modified":1474279471000},{"_id":"source/_posts/hello-world.md","hash":"8a02477044e2b77f1b262da2c48c01429e4a32e4","modified":1466591069000},{"_id":"source/_posts/middle.md","hash":"9c8069abe49cc5439e14799529676c03869c2e9f","modified":1474357058000},{"_id":"source/#blog/index.md","hash":"3e06b2a1c755088e47ba1b7b4762b3025d8b117b","modified":1474269773000},{"_id":"source/_posts/mu-new-page.md","hash":"b26dcf246d5c075c98d4c1dcf7be4a8767843781","modified":1474269773000},{"_id":"source/_posts/second.md","hash":"31929b804394189c54050e6a9c8cfabb9ef69781","modified":1474271624000},{"_id":"source/_posts/第一篇测试.md","hash":"60680300cb9c1cbdceac13cf05120a569b99ee8b","modified":1474270666000},{"_id":"source/about/index.md","hash":"3faf8627bd213e1b2518e903774ddc896b7216c9","modified":1474269773000},{"_id":"source/about/.DS_Store","hash":"dfbbe85daf72bf598a8a80981d83537bede89ef4","modified":1474279477000},{"_id":"source/archive/.DS_Store","hash":"46ba5fb3e7d7a4b2a07ea3b7d6b11243e4b4bc34","modified":1474343147000},{"_id":"themes/huno/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1474190789000},{"_id":"source/archive/index-1.md","hash":"f2f950a9c822ba8d4c5177338dd041073110b692","modified":1474351984000},{"_id":"source/archive/archive.md","hash":"773fa75b2774226fca6eec655ca21be1db392385","modified":1474343593000},{"_id":"source/archive/index.md","hash":"143faae8c7d54017b8f1f42e0729fd306026d9e1","modified":1474342967000},{"_id":"themes/huno/.git/config","hash":"6427fc07164643811f4ecb285662a352db74d4b2","modified":1474190789000},{"_id":"themes/huno/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1474190658000},{"_id":"themes/huno/.git/index","hash":"33cb5a597ddaf4b4c92371b1dcbe06103d784ecf","modified":1474253749000},{"_id":"themes/huno/.git/packed-refs","hash":"8647383fb9ce21a528fa4a1338a8f150043e6e13","modified":1474190789000},{"_id":"themes/huno/languages/.DS_Store","hash":"95f1f82c33c50db4ea66109ac8b8f8ae3d79ae32","modified":1474194051000},{"_id":"themes/huno/languages/zh-TW.yml","hash":"d865666c14c58c70738d9aef04ae14e38e750c14","modified":1474190789000},{"_id":"themes/huno/languages/default.yml","hash":"bddd7fd79412849a52b9a36aae36af111b2db619","modified":1474190789000},{"_id":"themes/huno/languages/zh-CN.yml","hash":"fc0fcc3819c03baeecf2aa51cec08257973288cf","modified":1474190789000},{"_id":"themes/huno/layout/.DS_Store","hash":"7bac7cd584076197160561cc9643c313d95bdaa2","modified":1474353430000},{"_id":"themes/huno/layout/archive.ejs","hash":"23aff325ab97b2c7dde6e757fa3add5226a88b4f","modified":1474190789000},{"_id":"themes/huno/layout/category.ejs","hash":"2b412d1b52b9da8ad19f6a66b1c18ab0b7546214","modified":1474190789000},{"_id":"themes/huno/layout/index.ejs","hash":"12c817a875f353c03d8795c2a7b653e4da22c17e","modified":1474190789000},{"_id":"themes/huno/layout/layout.ejs","hash":"4977031185ae4687c0ba0ec1f7aec5050b203726","modified":1474190789000},{"_id":"themes/huno/layout/post.ejs","hash":"86c9d13e8abdcff4d368e34595e2d2f11f37e9d4","modified":1474190789000},{"_id":"themes/huno/layout/tag.ejs","hash":"fefa03bed577cae2e1aac19bd5d30c5034f453a0","modified":1474190789000},{"_id":"themes/huno/layout/page.ejs","hash":"70a50ecf7e1aa9c658212f1e77783dcb287d56a6","modified":1474190789000},{"_id":"themes/huno/layout/page-archive.ejs","hash":"ce5523d829c0fdd6a79984fcf15e33572a220df9","modified":1474190789000},{"_id":"themes/huno/source/.DS_Store","hash":"f1b9d7e9b5dc9e9fbad1952079e8038ca26461e9","modified":1474268594000},{"_id":"themes/huno/layout/_partials/list-posts.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1474190789000},{"_id":"themes/huno/layout/_scripts/site-analytics.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1474190789000},{"_id":"themes/huno/cs-icon.png","hash":"4ba5bfbacb1a533f3561112406c305e9510aa8dd","modified":1474190789000},{"_id":"themes/huno/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1474190658000},{"_id":"themes/huno/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1474190658000},{"_id":"themes/huno/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1474190658000},{"_id":"themes/huno/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1474190658000},{"_id":"themes/huno/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1474190658000},{"_id":"themes/huno/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1474190658000},{"_id":"themes/huno/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1474190658000},{"_id":"themes/huno/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1474190658000},{"_id":"themes/huno/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1474190658000},{"_id":"themes/huno/layout/_partials/.DS_Store","hash":"78b98a2af929c9f4c4ab53ede8018864ccdda72e","modified":1474353446000},{"_id":"themes/huno/.git/logs/HEAD","hash":"ff08502ef31051a7b2785ce90d18674ab90b0153","modified":1474190789000},{"_id":"themes/huno/.git/hooks/update.sample","hash":"39355a075977d05708ef74e1b66d09a36e486df1","modified":1474190658000},{"_id":"themes/huno/layout/_partials/article.ejs","hash":"12993f72e718ac81763c2095f64b7ef3523f1777","modified":1474190789000},{"_id":"themes/huno/layout/_partials/duoshuo.ejs","hash":"7cfe423c088a3bf0565e27a1c17d1b99a260786b","modified":1474190789000},{"_id":"themes/huno/layout/_partials/archive.ejs","hash":"2c413cde5b1d3a475777e8ff8226762dfe92610c","modified":1474190789000},{"_id":"themes/huno/layout/_partials/disqus.ejs","hash":"30c043cc683c78f345a658cf64b37e55e6521685","modified":1474190789000},{"_id":"themes/huno/layout/_partials/footer.ejs","hash":"59070ce06159cfd45b13c9499b1e4f0a272d1019","modified":1474190789000},{"_id":"themes/huno/layout/_partials/pagination.ejs","hash":"1240c019aa4df269777c54c0d2124b534ec1f380","modified":1474190789000},{"_id":"themes/huno/layout/_partials/side-panel.ejs","hash":"09cf3dd8fa01e039c104a2105cf4050206d14444","modified":1474254093000},{"_id":"themes/huno/layout/_partials/social.ejs","hash":"9d40db0aa7f062adab1a0dcfa45c57e2a724ac00","modified":1474190789000},{"_id":"themes/huno/layout/_scripts/awesome-toc.ejs","hash":"b39df57929c246726ca45723ca9ad1a4104738c4","modified":1474190789000},{"_id":"themes/huno/layout/_scripts/.DS_Store","hash":"b272bec50b089fea28c49d414278063f624a8e83","modified":1474252577000},{"_id":"themes/huno/layout/_scripts/mathjax.ejs","hash":"2921f9f3b3c3e40f59c2d023764694a79ac07926","modified":1474190789000},{"_id":"themes/huno/layout/_scripts/killie6.ejs","hash":"2d5db8a53962ac704b8bfc40688319bed2e84ac9","modified":1474190789000},{"_id":"themes/huno/layout/_scripts/github-repo-widget.ejs","hash":"ee64a8e431318cb8fb25f59cfeec0def95b58912","modified":1474190789000},{"_id":"themes/huno/source/css/.DS_Store","hash":"fb6e1bfe2bb342462ee6472a2c7cf3ba656624a1","modified":1474253229000},{"_id":"themes/huno/source/css/animate.css","hash":"651fcf046b1bd2bff3ab4cb8947ff7fe058de373","modified":1474190789000},{"_id":"themes/huno/source/css/archive.css","hash":"7238ea5f6bda859e3bae7aaa546caf27fe1fb0cc","modified":1474190789000},{"_id":"themes/huno/source/css/china-social-icon.css","hash":"2f90442f6d0d289e49c07a85c2dae32cab8b2063","modified":1474190789000},{"_id":"themes/huno/source/css/highlight.styl","hash":"92eabbf94e7a06e968c356bedf4adb04700f1c2e","modified":1474190789000},{"_id":"themes/huno/source/fonts/.DS_Store","hash":"9f0502b4334f36fefcff374725bd4d25435f8e46","modified":1474194068000},{"_id":"themes/huno/source/css/uno.css","hash":"aa56b9421def95930a5d89b5210121bf4965ecca","modified":1474281983000},{"_id":"themes/huno/source/images/.DS_Store","hash":"6d458945e8808dcb2f916aa1b587b1606f9f0835","modified":1474264579000},{"_id":"themes/huno/source/images/totop.png","hash":"4f6cb11941e5a72b03cb00cf9d9d55671b4310eb","modified":1474190789000},{"_id":"themes/huno/source/js/awesome-toc.min.js","hash":"b4d0f2a33f8340eb2543e8b2cee0dfd745cfb54a","modified":1474190789000},{"_id":"themes/huno/source/js/jquery.githubRepoWidget.min.js","hash":"94a141fa474ec5022f7c397b4fd3ff92405ab755","modified":1474190789000},{"_id":"themes/huno/source/js/.DS_Store","hash":"be64d2399f1ca75ebf16870d763e51247a40ce8c","modified":1474253952000},{"_id":"themes/huno/source/js/scale.fix.js","hash":"ce593f56728cc1cedf2e513cb20b926de3b05e07","modified":1474190789000},{"_id":"themes/huno/source/js/main.js","hash":"15a9b80ca5d8ce2e4d04f93f74fb9f6de4141c32","modified":1474253986000},{"_id":"themes/huno/source/js/jquery.min.js","hash":"8b6babff47b8a9793f37036fd1b1a3ad41d38423","modified":1474190789000},{"_id":"themes/huno/.git/refs/heads/master","hash":"3c4512585bce805b5d221ad0b3f02fb85feb8b65","modified":1474190789000},{"_id":"themes/huno/.git/objects/pack/pack-1ad6c9f3284877fd6cc54bb0e73e0f22cbf3b17a.idx","hash":"705f5020e3af343d52ff293e0b25dd98166f9369","modified":1474190789000},{"_id":"themes/huno/source/fonts/china-social/china-social.svg","hash":"4bad780e6a31f4fa9fef037a3d9ecb8623042a6e","modified":1474190789000},{"_id":"themes/huno/source/fonts/china-social/china-social.woff","hash":"74c0ac5268cf7ffe270faaf7c960b74d483d2df1","modified":1474190789000},{"_id":"themes/huno/source/fonts/china-social/china-social.eot","hash":"a43a5c3d66f0d38639a595ebd02857e152ada475","modified":1474190789000},{"_id":"themes/huno/source/fonts/china-social/china-social.ttf","hash":"2f94360528097df7dcfb39baf8df5393a0d47ca3","modified":1474190789000},{"_id":"themes/huno/source/fonts/foundation-icons/.fontcustom-data","hash":"3b0cfb3ba2ee7ccae391bc66b3acaa6895932e5f","modified":1474190789000},{"_id":"themes/huno/source/fonts/china-social/readme.html","hash":"ca335751de11d6ef7721dc907571de39cef6e361","modified":1474190789000},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.eot","hash":"d584172686583fd510d8f04cf21e6e77fce51435","modified":1474190789000},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.css","hash":"426036f1d554b9dffae8b38acc36cade40d9521a","modified":1474190789000},{"_id":"themes/huno/source/fonts/foundation-icons/.DS_Store","hash":"42c0738534edbf3332f48b73bfdf5b220cad3d1f","modified":1474194068000},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.woff","hash":"112fb0e498037f2fea036adb8105e47638159eaa","modified":1474190789000},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.ttf","hash":"4b2bce6c792493a4a5716b6fec2dbefe89492c3f","modified":1474190789000},{"_id":"themes/huno/source/images/background-cover11.jpg","hash":"b9ed15cb1468b5f4a71a3dfddf1650b4132ccb9b","modified":1474252626000},{"_id":"themes/huno/.git/logs/refs/heads/master","hash":"ff08502ef31051a7b2785ce90d18674ab90b0153","modified":1474190789000},{"_id":"themes/huno/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1474190789000},{"_id":"themes/huno/source/images/avatar.jpg","hash":"23235056505c920c33e5817365a310454d49aaaa","modified":1474259287000},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.svg","hash":"bdca38f453f9935203fe8cd071e97d7f8576e0be","modified":1474190789000},{"_id":"themes/huno/.git/logs/refs/remotes/origin/HEAD","hash":"ff08502ef31051a7b2785ce90d18674ab90b0153","modified":1474190789000},{"_id":"themes/huno/source/images/background-cover.jpg","hash":"bfb4244c5ccb0b3cae6b08bf1c031e5ddbb1a6cf","modified":1474252767000},{"_id":"themes/huno/demo.gif","hash":"cf6121b4aa0f3b07a2f919099942d97206202aa8","modified":1474190789000},{"_id":"themes/huno/.git/objects/pack/pack-1ad6c9f3284877fd6cc54bb0e73e0f22cbf3b17a.pack","hash":"338a53ec00bc81a9ab6412a9fefe0ecc58eb2e8c","modified":1474190789000}],"Category":[],"Data":[],"Page":[{"title":"测试文章一","layout":"page-archive","tags":null,"_content":"\n\n###1.幸福，大概就是，你喜欢粘着的那个人，永远都不嫌你烦。 \n\n#####2.一个人最好的生活状态，是该看书时看书，该玩时尽情玩，看见优秀的人欣赏，看到落魄的人也不轻视，有自己的小生活和小情趣，不用去想改变世界，努力去活出自己。没人爱时专注自己，有人爱时，有能力拥抱彼此。 \n\n###3.人不都是这样吗，安慰别人的时候头头是道，自己遇上点过不去的坎立马无法自拔，道理都懂，只是情绪作祟，故事太撩人。\n\n#####4.你越是费劲心思的去取悦一个人，那个人就越有可能让你痛彻心扉。期待，是所有心痛的根源，心不动则不痛。 \n","source":"archive/archive.md","raw":"\n\ntitle: 测试文章一\n\nlayout: page-archive\n\ntags:\n---\n\n\n###1.幸福，大概就是，你喜欢粘着的那个人，永远都不嫌你烦。 \n\n#####2.一个人最好的生活状态，是该看书时看书，该玩时尽情玩，看见优秀的人欣赏，看到落魄的人也不轻视，有自己的小生活和小情趣，不用去想改变世界，努力去活出自己。没人爱时专注自己，有人爱时，有能力拥抱彼此。 \n\n###3.人不都是这样吗，安慰别人的时候头头是道，自己遇上点过不去的坎立马无法自拔，道理都懂，只是情绪作祟，故事太撩人。\n\n#####4.你越是费劲心思的去取悦一个人，那个人就越有可能让你痛彻心扉。期待，是所有心痛的根源，心不动则不痛。 \n","date":"2016-09-20T03:53:13.000Z","updated":"2016-09-20T03:53:13.000Z","path":"archive/archive.html","comments":1,"_id":"citb6ip9k0004z98zihdv2tih","content":"<p>###1.幸福，大概就是，你喜欢粘着的那个人，永远都不嫌你烦。 </p>\n<p>#####2.一个人最好的生活状态，是该看书时看书，该玩时尽情玩，看见优秀的人欣赏，看到落魄的人也不轻视，有自己的小生活和小情趣，不用去想改变世界，努力去活出自己。没人爱时专注自己，有人爱时，有能力拥抱彼此。 </p>\n<p>###3.人不都是这样吗，安慰别人的时候头头是道，自己遇上点过不去的坎立马无法自拔，道理都懂，只是情绪作祟，故事太撩人。</p>\n<p>#####4.你越是费劲心思的去取悦一个人，那个人就越有可能让你痛彻心扉。期待，是所有心痛的根源，心不动则不痛。 </p>\n","excerpt":"","more":"<p>###1.幸福，大概就是，你喜欢粘着的那个人，永远都不嫌你烦。 </p>\n<p>#####2.一个人最好的生活状态，是该看书时看书，该玩时尽情玩，看见优秀的人欣赏，看到落魄的人也不轻视，有自己的小生活和小情趣，不用去想改变世界，努力去活出自己。没人爱时专注自己，有人爱时，有能力拥抱彼此。 </p>\n<p>###3.人不都是这样吗，安慰别人的时候头头是道，自己遇上点过不去的坎立马无法自拔，道理都懂，只是情绪作祟，故事太撩人。</p>\n<p>#####4.你越是费劲心思的去取悦一个人，那个人就越有可能让你痛彻心扉。期待，是所有心痛的根源，心不动则不痛。 </p>\n"},{"title":"那些让你难忘的句子","layout":"page-archive","_content":"\n\n\n   \n 如果有来生，要做一棵树，站成永恒，没有悲欢的姿势。一半在尘土里安详，一半在风里飞扬，一半洒落阴凉，一半沐浴阳光。如果有来生，要做一只鸟，飞越永恒，没有迷途的苦恼。东方有火红的希望，南方有温暖的巢床，向西逐退残阳，向北唤醒芬芳。\n                                                                                                                                                                                            ——三毛 \n\n我爱你，不光是因为你的样子，还因为和你在一起时，我的样子。 \n                                    ——罗伊·克里夫曼《爱》 \n\n事隔经年，若我会见到你，我该如何祝贺你，以眼泪，以沉默。 \n                                                 ——拜伦《春逝》                    \n\n要么孤独，要么庸俗 \n——叔本华 \n\n如此情深，却难以启齿。原来你若真爱一个人，内心酸涩，反而会说不出话来，甜言蜜语，多数说给不相干的人听。—《她的二三事》 \n\n我一定不是这城市里唯一的怪人，一定有人和我一样，空虚时对着夜空唱歌到天明，也许我永远都遇不到他，但我熟悉他的心情。——几米\n\n生活总是让我们遍体鳞伤，但到后来，那些受伤的地方一定会变成我们最强壮的地方。——海明威《老人与海》 \n\n每一个不曾起舞的日子，都是对生命的辜负   \n —————尼采\n我是你在路上的最后一个过客，最后一个春天，最后一场雪，最后一次来生的战争   —保尔；艾侣雅\n\n那里有人喜欢孤独，不过是不喜欢失望\n\n我只是一个戏子，在别人的故事里，留着自己的眼泪\n\n你记得也好，最好你忘记，在这交会时互放的光亮\n\n一个人有两个我，一个在黑暗中醒着，一个在光明中睡着\n\n如我遇见你，事隔经年，我将如何致你，以眼泪，以沉默\n\n爱自己是终生浪漫的开始\n\n真爱的第一预兆，在男孩身上是胆怯，在女孩身上是大胆\n\n当一个人不能拥有的时候，他唯一能做的便是不要忘记了\n\n要是爱你爱的少些，话就可以说得多些了\n\n这世上真话本就不多，一位女子的脸红胜过一大段对白\n\n不惋惜，不呼唤，我也不啼哭，一切将逝去，如苹果花丛的薄雾，黄金的落叶堆满心间，我已不再青春年少\n\n岁月不饶人，我亦未曾绕过岁月\n\n\n","source":"archive/index.md","raw":"\ntitle: 那些让你难忘的句子\n\nlayout: page-archive\n\n---\n\n\n\n   \n 如果有来生，要做一棵树，站成永恒，没有悲欢的姿势。一半在尘土里安详，一半在风里飞扬，一半洒落阴凉，一半沐浴阳光。如果有来生，要做一只鸟，飞越永恒，没有迷途的苦恼。东方有火红的希望，南方有温暖的巢床，向西逐退残阳，向北唤醒芬芳。\n                                                                                                                                                                                            ——三毛 \n\n我爱你，不光是因为你的样子，还因为和你在一起时，我的样子。 \n                                    ——罗伊·克里夫曼《爱》 \n\n事隔经年，若我会见到你，我该如何祝贺你，以眼泪，以沉默。 \n                                                 ——拜伦《春逝》                    \n\n要么孤独，要么庸俗 \n——叔本华 \n\n如此情深，却难以启齿。原来你若真爱一个人，内心酸涩，反而会说不出话来，甜言蜜语，多数说给不相干的人听。—《她的二三事》 \n\n我一定不是这城市里唯一的怪人，一定有人和我一样，空虚时对着夜空唱歌到天明，也许我永远都遇不到他，但我熟悉他的心情。——几米\n\n生活总是让我们遍体鳞伤，但到后来，那些受伤的地方一定会变成我们最强壮的地方。——海明威《老人与海》 \n\n每一个不曾起舞的日子，都是对生命的辜负   \n —————尼采\n我是你在路上的最后一个过客，最后一个春天，最后一场雪，最后一次来生的战争   —保尔；艾侣雅\n\n那里有人喜欢孤独，不过是不喜欢失望\n\n我只是一个戏子，在别人的故事里，留着自己的眼泪\n\n你记得也好，最好你忘记，在这交会时互放的光亮\n\n一个人有两个我，一个在黑暗中醒着，一个在光明中睡着\n\n如我遇见你，事隔经年，我将如何致你，以眼泪，以沉默\n\n爱自己是终生浪漫的开始\n\n真爱的第一预兆，在男孩身上是胆怯，在女孩身上是大胆\n\n当一个人不能拥有的时候，他唯一能做的便是不要忘记了\n\n要是爱你爱的少些，话就可以说得多些了\n\n这世上真话本就不多，一位女子的脸红胜过一大段对白\n\n不惋惜，不呼唤，我也不啼哭，一切将逝去，如苹果花丛的薄雾，黄金的落叶堆满心间，我已不再青春年少\n\n岁月不饶人，我亦未曾绕过岁月\n\n\n","date":"2016-09-20T03:42:47.000Z","updated":"2016-09-20T03:42:47.000Z","path":"archive/index.html","comments":1,"_id":"citb6ip9p0005z98zb7ptii66","content":"<p> 如果有来生，要做一棵树，站成永恒，没有悲欢的姿势。一半在尘土里安详，一半在风里飞扬，一半洒落阴凉，一半沐浴阳光。如果有来生，要做一只鸟，飞越永恒，没有迷途的苦恼。东方有火红的希望，南方有温暖的巢床，向西逐退残阳，向北唤醒芬芳。<br>                                                                                                                                                                                            ——三毛 </p>\n<p>我爱你，不光是因为你的样子，还因为和你在一起时，我的样子。<br>                                    ——罗伊·克里夫曼《爱》 </p>\n<p>事隔经年，若我会见到你，我该如何祝贺你，以眼泪，以沉默。<br>                                                 ——拜伦《春逝》                    </p>\n<p>要么孤独，要么庸俗<br>——叔本华 </p>\n<p>如此情深，却难以启齿。原来你若真爱一个人，内心酸涩，反而会说不出话来，甜言蜜语，多数说给不相干的人听。—《她的二三事》 </p>\n<p>我一定不是这城市里唯一的怪人，一定有人和我一样，空虚时对着夜空唱歌到天明，也许我永远都遇不到他，但我熟悉他的心情。——几米</p>\n<p>生活总是让我们遍体鳞伤，但到后来，那些受伤的地方一定会变成我们最强壮的地方。——海明威《老人与海》 </p>\n<p>每一个不曾起舞的日子，都是对生命的辜负<br> —————尼采<br>我是你在路上的最后一个过客，最后一个春天，最后一场雪，最后一次来生的战争   —保尔；艾侣雅</p>\n<p>那里有人喜欢孤独，不过是不喜欢失望</p>\n<p>我只是一个戏子，在别人的故事里，留着自己的眼泪</p>\n<p>你记得也好，最好你忘记，在这交会时互放的光亮</p>\n<p>一个人有两个我，一个在黑暗中醒着，一个在光明中睡着</p>\n<p>如我遇见你，事隔经年，我将如何致你，以眼泪，以沉默</p>\n<p>爱自己是终生浪漫的开始</p>\n<p>真爱的第一预兆，在男孩身上是胆怯，在女孩身上是大胆</p>\n<p>当一个人不能拥有的时候，他唯一能做的便是不要忘记了</p>\n<p>要是爱你爱的少些，话就可以说得多些了</p>\n<p>这世上真话本就不多，一位女子的脸红胜过一大段对白</p>\n<p>不惋惜，不呼唤，我也不啼哭，一切将逝去，如苹果花丛的薄雾，黄金的落叶堆满心间，我已不再青春年少</p>\n<p>岁月不饶人，我亦未曾绕过岁月</p>\n","excerpt":"","more":"<p> 如果有来生，要做一棵树，站成永恒，没有悲欢的姿势。一半在尘土里安详，一半在风里飞扬，一半洒落阴凉，一半沐浴阳光。如果有来生，要做一只鸟，飞越永恒，没有迷途的苦恼。东方有火红的希望，南方有温暖的巢床，向西逐退残阳，向北唤醒芬芳。<br>                                                                                                                                                                                            ——三毛 </p>\n<p>我爱你，不光是因为你的样子，还因为和你在一起时，我的样子。<br>                                    ——罗伊·克里夫曼《爱》 </p>\n<p>事隔经年，若我会见到你，我该如何祝贺你，以眼泪，以沉默。<br>                                                 ——拜伦《春逝》                    </p>\n<p>要么孤独，要么庸俗<br>——叔本华 </p>\n<p>如此情深，却难以启齿。原来你若真爱一个人，内心酸涩，反而会说不出话来，甜言蜜语，多数说给不相干的人听。—《她的二三事》 </p>\n<p>我一定不是这城市里唯一的怪人，一定有人和我一样，空虚时对着夜空唱歌到天明，也许我永远都遇不到他，但我熟悉他的心情。——几米</p>\n<p>生活总是让我们遍体鳞伤，但到后来，那些受伤的地方一定会变成我们最强壮的地方。——海明威《老人与海》 </p>\n<p>每一个不曾起舞的日子，都是对生命的辜负<br> —————尼采<br>我是你在路上的最后一个过客，最后一个春天，最后一场雪，最后一次来生的战争   —保尔；艾侣雅</p>\n<p>那里有人喜欢孤独，不过是不喜欢失望</p>\n<p>我只是一个戏子，在别人的故事里，留着自己的眼泪</p>\n<p>你记得也好，最好你忘记，在这交会时互放的光亮</p>\n<p>一个人有两个我，一个在黑暗中醒着，一个在光明中睡着</p>\n<p>如我遇见你，事隔经年，我将如何致你，以眼泪，以沉默</p>\n<p>爱自己是终生浪漫的开始</p>\n<p>真爱的第一预兆，在男孩身上是胆怯，在女孩身上是大胆</p>\n<p>当一个人不能拥有的时候，他唯一能做的便是不要忘记了</p>\n<p>要是爱你爱的少些，话就可以说得多些了</p>\n<p>这世上真话本就不多，一位女子的脸红胜过一大段对白</p>\n<p>不惋惜，不呼唤，我也不啼哭，一切将逝去，如苹果花丛的薄雾，黄金的落叶堆满心间，我已不再青春年少</p>\n<p>岁月不饶人，我亦未曾绕过岁月</p>\n"}],"Post":[{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","slug":"hello-world","published":1,"date":"2016-06-22T09:25:29.000Z","updated":"2016-06-22T10:24:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"citb6ip8v0000z98z2nly18t8","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"external\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"external\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"external\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"external\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"external\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"external\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"external\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"external\">Deployment</a></p>\n","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\">Deployment</a></p>\n"},{"title":"好事近·汴京赐宴闻教坊乐有感","date":"2016-09-20T07:29:15.000Z","_content":"\n\n\n好事近·汴京赐宴闻教坊乐有感\n朝代：宋代\n\n作者：韩元吉\n\n原文：\n凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。\n杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 ","source":"_posts/middle.md","raw":"---\ntitle: 好事近·汴京赐宴闻教坊乐有感\ndate: 2016-09-20 15:29:15\ntags:\n---\n\n\n\n好事近·汴京赐宴闻教坊乐有感\n朝代：宋代\n\n作者：韩元吉\n\n原文：\n凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。\n杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 ","slug":"middle","published":1,"updated":"2016-09-20T07:37:38.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"citb6ip920001z98zfl9ycmqw","content":"<p>好事近·汴京赐宴闻教坊乐有感<br>朝代：宋代</p>\n<p>作者：韩元吉</p>\n<p>原文：<br>凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。<br>杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 </p>\n","excerpt":"","more":"<p>好事近·汴京赐宴闻教坊乐有感<br>朝代：宋代</p>\n<p>作者：韩元吉</p>\n<p>原文：<br>凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。<br>杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 </p>\n"},{"title":"测试到心累","date":"2016-09-19T07:43:21.000Z","_content":"\n![Mou icon](../../public/images/background-cover.jpg)\n\n前段时间遇到一个小需求：要求在分享出来的h5页面中，有一个立即打开的按钮，如果本地安装了我们的app，那么点击就直接唤起本地app，如果没有安装，则跳转到下载。\n\n因为从来没有做过这个需求，因此这注定是一个苦逼的调研过程。\n\n我们最开始就面临2个问题：一是如何唤起本地app，二是如何判断浏览器是否安装了对应app。\n\n如何唤起本地app\n\n首先，想要实现这个需求，肯定是必须要客户端同学的配合才行，因此我们不用知道所有的实现细节，我们从前端角度思考看这个问题，需要知道的一点是，ios与Android都支持一种叫做schema协议的链接。比如网易新闻客户端的协议为\n\nnewsapp://xxxxx\n当然，这个协议不需要我们前端去实现，我们只需要将协议放在a标签的href属性里，或者使用location.href与iframe来实现激活这个链接。而location.href与iframe是解决这个需求的关键。\n\n在ios中，还支持通过smart app banner来唤起app，即通过一个meta标签，在标签里带上app的信息，和打开后的行为，代码形如\n\n<meta name=\"apple-itunes-app\" content=\"app-id=1023600494, app-argument=tigerbrokersusstock://com.tigerbrokers.usstock/post?postId=7125\" />\n我们还需要知道的一点是，微信里屏蔽了schema协议。除非你是微信的合作伙伴之类的，他们专门给你配置进白名单。否则我们就没办法通过这个协议在微信中直接唤起app。\n\n因此我们会判断页面场景是否在微信中，如果在微信中，则会提示用户在浏览器中打开。\n\n如何判断本地是否安装了app\n\n首先我们可以确认的是，在浏览器中无法明确的判断本地是否安装了app。因此我们必须采取一些取巧的思路来解决这个问题。\n\n我们能够很容易想到，采用设置一个延迟定时器setTimeout的方式，第一时间尝试唤起app，如果200ms没有唤起成功，则默认本地没有安装app，200ms以后，将会触发下载行为。\n\n结合这个思路，我们来全局考虑一下这个需求应该采用什么样的方案来实现它。\n\n使用location.href的同学可能会面临一个担忧，在有的浏览器中，当我们尝试激活schema link的时候，若本地没有安装app，则会跳转到一个浏览器默认的错误页面去了。因此大多数人采用的解决方案都是使用iframe\n\n测试了很多浏览器，没有发现过这种情况\n\n后来观察了网易新闻，今日头条，YY等的实现方案，发现大家都采用的是iframe来实现。好吧，面对这种情况，只能屈服。\n\n整理一下目前的思路，得到下面的解决方案\n\nvar url = {\n  open: 'app://xxxxx',\n  down: 'xxxxxxxx'\n};\nvar iframe = document.createElement('iframe');\nvar body = document.body;\niframe.style.cssText='display:none;width=0;height=0';\nvar timer = null;\n\n// 立即打开的按钮\nvar openapp = document.getElementById('openapp');\nopenapp.addEventListener('click', function() {\n  if(/MicroMessenger/gi.test(navigator.userAgent) {\n    // 引导用户在浏览器中打开\n  }) else{\n    body.appendChild(iframe);\n    iframe.src = url.open;\n    timer = setTimeout(function() {\n      wondow.location.href = url.down;\n    }, 500);\n  }\n}, false)\n想法很美好，现实很残酷。一测试，就发现简单的这样实现有许多的问题。\n\n第一个问题在于，当页面成功唤起app之后，我们再切换回来浏览器，发现跳转到了下载页面。\n\n为了解决这个问题，发现各个公司都进行了不同方式的尝试。\n\n也是历经的很多折磨，发现了几个比较有用的事件。\n\npageshow： 页面显示时触发，在load事件之后触发。需要将该事件绑定到window上才会触发\n\npagehide: 页面隐藏时触发\n\nvisibilitychange： 页面隐藏没有在当前显示时触发，比如切换tab，也会触发该事件\n\ndocument.hidden 当页面隐藏时，该值为true，显示时为false\n\n由于各个浏览器的支持情况不同，我们需要将这些事件都给绑定上，即使这样，也不一定能够保证所有的浏览器都能够解决掉这个小问题，实在没办法的事情就不管了。\n\n因此需要扩充一下上面的方案，当本地app被唤起，则页面会隐藏掉，就会触发pagehide与visibilitychange事件\n\n$(document).on('visibilitychange webkitvisibilitychange', function() {\n    var tag = document.hidden || document.webkitHidden;\n    if (tag) {\n        clearTimeout(timer);\n    }\n})\n\n$(window).on('pagehide', function() {\n    clearTimeout(timer);\n})\n而另外一个问题就是IOS9+下面的问题了。ios9的Safari，根本不支持通过iframe跳转到其他页面去。也就是说，在safari下，我的整体方案被全盘否决！\n\n于是我就只能尝试使用location.href的方式，这个方式能够唤起app，但是有一个坑爹的问题，使用schema协议唤起app会有弹窗而不会直接跳转去app！甚至当本地没有app时，会被判断为链接无效，然后还有一个弹窗。\n\n这个弹窗会造成什么问题呢？如果用户不点确认按钮，根据上面的逻辑，这个时候就会发现页面会自动跳转到下载去了。而且无效的弹窗提示在用户体验上是不允许出现的。\n\n好吧，继续扒别人的代码，看看别人是如何实现的。然后我又去观摩了其他公司的实现结果，发现网易新闻，今日头条都可以在ios直接从微信中唤起 app。真是神奇了，可是今日头条在Android版微信上也没办法直接唤起的，他们在Android上都是直接到腾讯应用宝的下载里去。所以按道理来说 这不是添加了白名单。\n\n为了找到这个问题的解决方案，我在网易新闻的页面中扒出了他们的代码，并整理如下，添加了部分注释\n\n\nwindow.NRUM = window.NRUM || {};\nwindow.NRUM.config = {\n    key:'27e86c0843344caca7ba9ea652d7948d',\n    clientStart: +new Date()\n};\n(function() {\n    var n = document.getElementsByTagName('script')[0],\n        s = document.createElement('script');\n\n    s.type = 'text/javascript';\n    s.async = true;\n    s.src = '//nos.netease.com/apmsdk/napm-web-min-1.1.3.js';\n    n.parentNode.insertBefore(s, n);\n})();\n\n\n;\n(function(window,doc){\n\n    // http://apm.netease.com/manual?api=web\n    NRUM.mark && NRUM.mark('pageload', true)\n\n    var list = []\n    var config = null\n\n    // jsonp\n    function jsonp(a, b, c) {\n        var d;\n        d = document.createElement('script');\n        d.src = a;\n        c && (d.charset = c);\n        d.onload = function() {\n            this.onload = this.onerror = null;\n            this.parentNode.removeChild(this);\n            b && b(!0);\n        };\n        d.onerror = function() {\n            this.onload = this.onerror = null;\n            this.parentNode.removeChild(this);\n            b && b(!1);\n        };\n        document.head.appendChild(d);\n    };\n\n\n    function localParam(search,hash){\n        search = search || window.location.search;\n        hash = hash || window.location.hash;\n        var fn = function(str,reg){\n            if(str){\n                var data = {};\n                str.replace(reg,function( $0, $1, $2, $3 ){\n                    data[ $1 ] = $3;\n                });\n                return data;\n            }\n        }\n        return {search: fn(search,new RegExp( \"([^?=&]+)(=([^&]*))?\", \"g\" ))||{},hash: fn(hash,new RegExp( \"([^#=&]+)(=([^&]*))?\", \"g\" ))||{}};\n    }\n\n    jsonp('http://active.163.com/service/form/v1/5847/view/1047.jsonp')\n\n    window.search = localParam().search\n    window._callback = function(data) {\n        window._callback = null\n        list = data.list\n        if(search.s && !!search.s.match(/^wap/i)) {\n            config = list.filter(function(item){\n                return item.type === 'wap'\n            })[0]\n            return\n        }\n        config = list.filter(function(item){\n            return item.type === search.s\n        })[0]\n    }\n\n    var isAndroid = !!navigator.userAgent.match(/android/ig),\n        isIos = !!navigator.userAgent.match(/iphone|ipod/ig),\n        isIpad = !!navigator.userAgent.match(/ipad/ig),\n        isIos9 = !!navigator.userAgent.match(/OS 9/ig),\n        isYx = !!navigator.userAgent.match(/MailMaster_Android/i),\n        isNewsapp = !!navigator.userAgent.match(/newsapp/i),\n        isWeixin = (/MicroMessenger/ig).test(navigator.userAgent),\n        isYixin = (/yixin/ig).test(navigator.userAgent),\n        isQQ = (/qq/ig).test(navigator.userAgent),\n        params = localParam().search,\n        url = 'newsapp://',\n        iframe = document.getElementById('iframe');\n\n    var isIDevicePhone = (/iphone|ipod/gi).test(navigator.platform);\n    var isIDeviceIpad = !isIDevicePhone && (/ipad/gi).test(navigator.platform);\n    var isIDevice = isIDevicePhone || isIDeviceIpad;\n    var isandroid2_x = !isIDevice && (/android\\s?2\\./gi).test(navigator.userAgent);\n    var isIEMobile = !isIDevice && !isAndroid && (/MSIE/gi).test(navigator.userAgent);\n    var android_url = (!isandroid2_x) ? \"http://3g.163.com/links/4304\" : \"http://3g.163.com/links/6264\";\n    var ios_url = \"http://3g.163.com/links/3615\";\n    var wphone_url = \"http://3g.163.com/links/3614\";\n    var channel = params.s || 'newsapp'\n\n    // 判断在不同环境下app的url\n    if(params.docid){\n        if(params['boardid'] && params['title']){\n            url = url + 'comment/' + params.boardid + '/' + params.docid + '/' + params.title\n        }else{\n            url = url + 'doc/' + params.docid\n        }\n    }else if(params.sid){\n        url = url + 'topic/' + params.sid\n    }else if(params.pid){\n        var pid = params.pid.split('_')\n        url = url + 'photo/' + pid[0] + '/' + pid[1]\n    }else if(params.vid){\n        url = url + 'video/' + params.vid\n    }else if(params.liveRoomid){\n        url = url + 'live/' + params.liveRoomid\n    }else if(params.url){\n        url = url + 'web/' + decodeURIComponent(params.url)\n    }else if(params.expertid){\n        url = url + 'expert/' + params.expertid\n    }else if(params.subjectid){\n        url = url + 'subject/' + params.subjectid\n    }else if(params.readerid){\n        url = url + 'reader/' + params.readerid\n    }else{\n        url += 'startup'\n    }\n    if(url.indexOf('?') >= 0){\n        url += '&s=' + (params.s || 'sps')\n    }else{\n        url += '?s=' + (params.s || 'sps')\n    }\n\n    // ios && 易信  用iframe 打开\n    if((isIos||isIpad) && navigator.userAgent.match(/yixin/i)) {\n        document.getElementById('iframe').src = url;\n    }\n\n    var height = document.documentElement.clientHeight;\n\n    // 通常情况下先尝试使用iframe打开\n    document.getElementById('iframe').src = url;\n\n    // 移动端浏览器中，将下载页面显示出来\n    if(!isWeixin && !isQQ && !isYixin && !isYx){\n        document.querySelector('.main-body').style.display = 'block'\n        if(isIos9){\n            document.querySelector('.main-body').classList.add('showtip')\n        }\n\n        setTimeout(function(){\n            document.body.scrollTop = 0\n        },200)\n    }else{\n        document.getElementById('guide').style.display = 'block'\n    }\n\n    // Forward To Redirect Url\n    // Add by zhanzhixiang 12/28/2015\n    if (params.redirect) {\n        var redirectUrl = decodeURIComponent(params.redirect);\n        if ( typeof(URL) === 'function' && new URL(redirectUrl).hostname.search(\"163.com\") !== -1) {\n            window.location.href = redirectUrl;\n        } else if (redirectUrl.search(\"163.com\") !== -1){\n            window.location.href = redirectUrl;\n        };\n    }\n\n    // Forward To Redirect Url End\n    if ((isWeixin || isQQ) && isAndroid) {\n        window.location.href = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.netease.newsreader.activity&ckey=CK1331205846719&android_schema=' +　url.match(/(.*)\\?/)[1]\n    }\n\n    if(isIos||isIpad){\n        document.getElementById(\"guide\").classList.add('iosguideopen')\n    }else if (isAndroid){\n        document.getElementById(\"guide\").classList.add('androidguideopen')\n    }else{\n        // window.location.href = 'http://www.163.com/newsapp'\n    }\n\n    document.getElementById('link').addEventListener('click', function(){\n\n        // 统计\n        neteaseTracker && neteaseTracker(false,'http://sps.163.com/func/?func=downloadapp&modelid='+modelid+'&spst='+spst+'&spsf&spss=' + channel,'', 'sps' )\n\n        if (config) {\n            android_url = config.android\n        }\n        if (config && config.iOS) {\n            ios_url = config.iOS\n        }\n        if(isWeixin || isQQ){\n            return\n        }\n        var msg = isIDeviceIpad ? \"检测到您正在使用iPad, 是否直接前往AppStore下载?\" : \"检测到您正在使用iPhone, 是否直接前往AppStore下载?\";\n        if (isIDevice){\n            window.location = ios_url;\n            return;\n        }else if(isAndroid){\n            // uc浏览器用iframe唤醒\n            if(navigator.userAgent.match(/ucbrowser|yixin|MailMaster/i)){\n                document.getElementById('iframe').src = url;\n            } else {\n                window.location.href = url;\n            }\n            setTimeout(function(){\n                if(document.webkitHidden) {\n                    return\n                }\n                if (confirm(\"检测到您正在使用Android 手机，是否直接下载程序安装包？\")) {\n                    neteaseTracker && neteaseTracker(false,'http://sps.163.com/func/?func=downloadapp_pass&modelid='+modelid+'&spst='+spst+'&spsf&spss=' + channel,'', 'sps' )\n                    window.location.href = android_url;\n                } else {\n                    neteaseTracker && neteaseTracker(false,'http://sps.163.com/func/?func=downloadapp_cancel&modelid='+modelid+'&spst='+spst+'&spsf&spss=' + channel,'', 'sps' )\n                }\n            },200)\n            return;\n        }else if(isIEMobile){\n            window.location = wphone_url;\n            return;\n        }else{\n            window.open('http://www.163.com/special/00774IQ6/newsapp_download.html');\n            return;\n        }\n    }, false)\n\n    setTimeout(function(){\n        if(isIDevice && params.notdownload != 1 && !isNewsapp && !isIos9){\n            document.getElementById('link').click()\n        }\n    }, 1000)\n\n})(window,document);\n虽然有一些外部的引用，和一些搞不懂是干什么用的方法和变量，但是基本逻辑还是能够看明白。好像也没有什么特别的地方。研究了许久，看到了一个jsonp请求很奇特。这是来干嘛用的？\n\n于是费尽千辛万苦，搜索了很多文章，最终锁定了一个关键的名词 Universal links。\n\n如果我早知道这个名词，那么问题就不会变的那么束手无策。所以这个东西是什么呢？\n\nApple为iOS 9发布了一个所谓的通用链接的深层链接特性，即Universal links。虽然它并不完美，但是这一发布，让数以千计的应用开发人员突然意识到自己的应用体验被打破。\n\nUniversal links，一种能够方便的通过传统的HTTP/HTTPS 链接来启动App，使用相同的网址打开网站和App。\n\n关于这个问题的提问与universal links的介绍 点击这里查看\n\nios9推行的一个新的协议！\n\n关于本文的这个问题，国内的论坛有许许多多的文章来解决，但是提到universal  links的文章少之又少，而我想吐槽的是，我们的ios开发也尼玛不知道这个名词，搞什么鬼。他改变了用户体验的关键在于，微信没有屏蔽这个协议。因此 如果我们的app注册了这个协议，那么我们就能够从微信中直接唤起app。\n\n这个时候我就发现，上面贴的网易新闻代码中的jsonp请求的内容，就是这个协议必须的一个叫做apple-app-site-association的JSON文件\n\n{\n   \"applinks\": {\n       \"apps\": [ ],\n       \"details\": {\n           \"TEAM-IDENTIFIER.YOUR.BUNDLE.IDENTIFIER\": {\n               \"paths\": [\n                   \"*\"\n               ]\n           }\n       }\n   }\n}\n大家可以直接访问这个链接，查看里面的内容\n\nhttp://active.163.com/service/form/v1/5847/view/1047.jsonp\n\n至于universal links具体如何实现，让ios的同学去搞定吧，这里提供两个参考文章\n\nhttp://www.cocoachina.com/bbs/read.php?tid-1486368.html\n\nhttps://blog.branch.io/how-to-setup-universal-links-to-deep-link-on-apple-ios-9\n\n支持了这个协议之后，我们又可以通过iframe来唤起app了，因此基本逻辑就是这样了。最终的调研结果是\n\n没有完美的解决方案\n\n就算是网易新闻，这个按钮在使用过程中也会有一些小bug，无法做到完美的状态。\n\n因为我们面临许多没办法解决的问题，比如无法真正意义上的判断本地是否安装了app，pageshow，pagehide并不是所有的浏览器都支持等。很多其他博客里面，什么计算时间差等方案，根！本！没！有！用！我还花了很久的时间去研究这个方案。\n\n老实说，从微信中跳转到外部浏览器，并不是一个好的解决方案，这样会导致很多用户流失，因此大家都在ios上实现了universal links，而我更加倾向的方案是知乎的解决，他们从设计上避免了在一个按钮上来判断这个逻辑，而采用了两个按钮的方式。\n\n网易新闻的逻辑是，点击打开会调整到一个下载页面，这个下载页面一加载完成就尝试打开app，如果打开了就直接跑到app里面去了，如果没有就在页面上有一个立即下载的按钮，按钮行只有下载处理。\n\n这个问题就总结到这里，如果大家有更好的方案，欢迎与我沟通。","source":"_posts/second.md","raw":"---\ntitle: 测试到心累\ndate: 2016-09-19 15:43:21\ntags:\n---\n\n![Mou icon](../../public/images/background-cover.jpg)\n\n前段时间遇到一个小需求：要求在分享出来的h5页面中，有一个立即打开的按钮，如果本地安装了我们的app，那么点击就直接唤起本地app，如果没有安装，则跳转到下载。\n\n因为从来没有做过这个需求，因此这注定是一个苦逼的调研过程。\n\n我们最开始就面临2个问题：一是如何唤起本地app，二是如何判断浏览器是否安装了对应app。\n\n如何唤起本地app\n\n首先，想要实现这个需求，肯定是必须要客户端同学的配合才行，因此我们不用知道所有的实现细节，我们从前端角度思考看这个问题，需要知道的一点是，ios与Android都支持一种叫做schema协议的链接。比如网易新闻客户端的协议为\n\nnewsapp://xxxxx\n当然，这个协议不需要我们前端去实现，我们只需要将协议放在a标签的href属性里，或者使用location.href与iframe来实现激活这个链接。而location.href与iframe是解决这个需求的关键。\n\n在ios中，还支持通过smart app banner来唤起app，即通过一个meta标签，在标签里带上app的信息，和打开后的行为，代码形如\n\n<meta name=\"apple-itunes-app\" content=\"app-id=1023600494, app-argument=tigerbrokersusstock://com.tigerbrokers.usstock/post?postId=7125\" />\n我们还需要知道的一点是，微信里屏蔽了schema协议。除非你是微信的合作伙伴之类的，他们专门给你配置进白名单。否则我们就没办法通过这个协议在微信中直接唤起app。\n\n因此我们会判断页面场景是否在微信中，如果在微信中，则会提示用户在浏览器中打开。\n\n如何判断本地是否安装了app\n\n首先我们可以确认的是，在浏览器中无法明确的判断本地是否安装了app。因此我们必须采取一些取巧的思路来解决这个问题。\n\n我们能够很容易想到，采用设置一个延迟定时器setTimeout的方式，第一时间尝试唤起app，如果200ms没有唤起成功，则默认本地没有安装app，200ms以后，将会触发下载行为。\n\n结合这个思路，我们来全局考虑一下这个需求应该采用什么样的方案来实现它。\n\n使用location.href的同学可能会面临一个担忧，在有的浏览器中，当我们尝试激活schema link的时候，若本地没有安装app，则会跳转到一个浏览器默认的错误页面去了。因此大多数人采用的解决方案都是使用iframe\n\n测试了很多浏览器，没有发现过这种情况\n\n后来观察了网易新闻，今日头条，YY等的实现方案，发现大家都采用的是iframe来实现。好吧，面对这种情况，只能屈服。\n\n整理一下目前的思路，得到下面的解决方案\n\nvar url = {\n  open: 'app://xxxxx',\n  down: 'xxxxxxxx'\n};\nvar iframe = document.createElement('iframe');\nvar body = document.body;\niframe.style.cssText='display:none;width=0;height=0';\nvar timer = null;\n\n// 立即打开的按钮\nvar openapp = document.getElementById('openapp');\nopenapp.addEventListener('click', function() {\n  if(/MicroMessenger/gi.test(navigator.userAgent) {\n    // 引导用户在浏览器中打开\n  }) else{\n    body.appendChild(iframe);\n    iframe.src = url.open;\n    timer = setTimeout(function() {\n      wondow.location.href = url.down;\n    }, 500);\n  }\n}, false)\n想法很美好，现实很残酷。一测试，就发现简单的这样实现有许多的问题。\n\n第一个问题在于，当页面成功唤起app之后，我们再切换回来浏览器，发现跳转到了下载页面。\n\n为了解决这个问题，发现各个公司都进行了不同方式的尝试。\n\n也是历经的很多折磨，发现了几个比较有用的事件。\n\npageshow： 页面显示时触发，在load事件之后触发。需要将该事件绑定到window上才会触发\n\npagehide: 页面隐藏时触发\n\nvisibilitychange： 页面隐藏没有在当前显示时触发，比如切换tab，也会触发该事件\n\ndocument.hidden 当页面隐藏时，该值为true，显示时为false\n\n由于各个浏览器的支持情况不同，我们需要将这些事件都给绑定上，即使这样，也不一定能够保证所有的浏览器都能够解决掉这个小问题，实在没办法的事情就不管了。\n\n因此需要扩充一下上面的方案，当本地app被唤起，则页面会隐藏掉，就会触发pagehide与visibilitychange事件\n\n$(document).on('visibilitychange webkitvisibilitychange', function() {\n    var tag = document.hidden || document.webkitHidden;\n    if (tag) {\n        clearTimeout(timer);\n    }\n})\n\n$(window).on('pagehide', function() {\n    clearTimeout(timer);\n})\n而另外一个问题就是IOS9+下面的问题了。ios9的Safari，根本不支持通过iframe跳转到其他页面去。也就是说，在safari下，我的整体方案被全盘否决！\n\n于是我就只能尝试使用location.href的方式，这个方式能够唤起app，但是有一个坑爹的问题，使用schema协议唤起app会有弹窗而不会直接跳转去app！甚至当本地没有app时，会被判断为链接无效，然后还有一个弹窗。\n\n这个弹窗会造成什么问题呢？如果用户不点确认按钮，根据上面的逻辑，这个时候就会发现页面会自动跳转到下载去了。而且无效的弹窗提示在用户体验上是不允许出现的。\n\n好吧，继续扒别人的代码，看看别人是如何实现的。然后我又去观摩了其他公司的实现结果，发现网易新闻，今日头条都可以在ios直接从微信中唤起 app。真是神奇了，可是今日头条在Android版微信上也没办法直接唤起的，他们在Android上都是直接到腾讯应用宝的下载里去。所以按道理来说 这不是添加了白名单。\n\n为了找到这个问题的解决方案，我在网易新闻的页面中扒出了他们的代码，并整理如下，添加了部分注释\n\n\nwindow.NRUM = window.NRUM || {};\nwindow.NRUM.config = {\n    key:'27e86c0843344caca7ba9ea652d7948d',\n    clientStart: +new Date()\n};\n(function() {\n    var n = document.getElementsByTagName('script')[0],\n        s = document.createElement('script');\n\n    s.type = 'text/javascript';\n    s.async = true;\n    s.src = '//nos.netease.com/apmsdk/napm-web-min-1.1.3.js';\n    n.parentNode.insertBefore(s, n);\n})();\n\n\n;\n(function(window,doc){\n\n    // http://apm.netease.com/manual?api=web\n    NRUM.mark && NRUM.mark('pageload', true)\n\n    var list = []\n    var config = null\n\n    // jsonp\n    function jsonp(a, b, c) {\n        var d;\n        d = document.createElement('script');\n        d.src = a;\n        c && (d.charset = c);\n        d.onload = function() {\n            this.onload = this.onerror = null;\n            this.parentNode.removeChild(this);\n            b && b(!0);\n        };\n        d.onerror = function() {\n            this.onload = this.onerror = null;\n            this.parentNode.removeChild(this);\n            b && b(!1);\n        };\n        document.head.appendChild(d);\n    };\n\n\n    function localParam(search,hash){\n        search = search || window.location.search;\n        hash = hash || window.location.hash;\n        var fn = function(str,reg){\n            if(str){\n                var data = {};\n                str.replace(reg,function( $0, $1, $2, $3 ){\n                    data[ $1 ] = $3;\n                });\n                return data;\n            }\n        }\n        return {search: fn(search,new RegExp( \"([^?=&]+)(=([^&]*))?\", \"g\" ))||{},hash: fn(hash,new RegExp( \"([^#=&]+)(=([^&]*))?\", \"g\" ))||{}};\n    }\n\n    jsonp('http://active.163.com/service/form/v1/5847/view/1047.jsonp')\n\n    window.search = localParam().search\n    window._callback = function(data) {\n        window._callback = null\n        list = data.list\n        if(search.s && !!search.s.match(/^wap/i)) {\n            config = list.filter(function(item){\n                return item.type === 'wap'\n            })[0]\n            return\n        }\n        config = list.filter(function(item){\n            return item.type === search.s\n        })[0]\n    }\n\n    var isAndroid = !!navigator.userAgent.match(/android/ig),\n        isIos = !!navigator.userAgent.match(/iphone|ipod/ig),\n        isIpad = !!navigator.userAgent.match(/ipad/ig),\n        isIos9 = !!navigator.userAgent.match(/OS 9/ig),\n        isYx = !!navigator.userAgent.match(/MailMaster_Android/i),\n        isNewsapp = !!navigator.userAgent.match(/newsapp/i),\n        isWeixin = (/MicroMessenger/ig).test(navigator.userAgent),\n        isYixin = (/yixin/ig).test(navigator.userAgent),\n        isQQ = (/qq/ig).test(navigator.userAgent),\n        params = localParam().search,\n        url = 'newsapp://',\n        iframe = document.getElementById('iframe');\n\n    var isIDevicePhone = (/iphone|ipod/gi).test(navigator.platform);\n    var isIDeviceIpad = !isIDevicePhone && (/ipad/gi).test(navigator.platform);\n    var isIDevice = isIDevicePhone || isIDeviceIpad;\n    var isandroid2_x = !isIDevice && (/android\\s?2\\./gi).test(navigator.userAgent);\n    var isIEMobile = !isIDevice && !isAndroid && (/MSIE/gi).test(navigator.userAgent);\n    var android_url = (!isandroid2_x) ? \"http://3g.163.com/links/4304\" : \"http://3g.163.com/links/6264\";\n    var ios_url = \"http://3g.163.com/links/3615\";\n    var wphone_url = \"http://3g.163.com/links/3614\";\n    var channel = params.s || 'newsapp'\n\n    // 判断在不同环境下app的url\n    if(params.docid){\n        if(params['boardid'] && params['title']){\n            url = url + 'comment/' + params.boardid + '/' + params.docid + '/' + params.title\n        }else{\n            url = url + 'doc/' + params.docid\n        }\n    }else if(params.sid){\n        url = url + 'topic/' + params.sid\n    }else if(params.pid){\n        var pid = params.pid.split('_')\n        url = url + 'photo/' + pid[0] + '/' + pid[1]\n    }else if(params.vid){\n        url = url + 'video/' + params.vid\n    }else if(params.liveRoomid){\n        url = url + 'live/' + params.liveRoomid\n    }else if(params.url){\n        url = url + 'web/' + decodeURIComponent(params.url)\n    }else if(params.expertid){\n        url = url + 'expert/' + params.expertid\n    }else if(params.subjectid){\n        url = url + 'subject/' + params.subjectid\n    }else if(params.readerid){\n        url = url + 'reader/' + params.readerid\n    }else{\n        url += 'startup'\n    }\n    if(url.indexOf('?') >= 0){\n        url += '&s=' + (params.s || 'sps')\n    }else{\n        url += '?s=' + (params.s || 'sps')\n    }\n\n    // ios && 易信  用iframe 打开\n    if((isIos||isIpad) && navigator.userAgent.match(/yixin/i)) {\n        document.getElementById('iframe').src = url;\n    }\n\n    var height = document.documentElement.clientHeight;\n\n    // 通常情况下先尝试使用iframe打开\n    document.getElementById('iframe').src = url;\n\n    // 移动端浏览器中，将下载页面显示出来\n    if(!isWeixin && !isQQ && !isYixin && !isYx){\n        document.querySelector('.main-body').style.display = 'block'\n        if(isIos9){\n            document.querySelector('.main-body').classList.add('showtip')\n        }\n\n        setTimeout(function(){\n            document.body.scrollTop = 0\n        },200)\n    }else{\n        document.getElementById('guide').style.display = 'block'\n    }\n\n    // Forward To Redirect Url\n    // Add by zhanzhixiang 12/28/2015\n    if (params.redirect) {\n        var redirectUrl = decodeURIComponent(params.redirect);\n        if ( typeof(URL) === 'function' && new URL(redirectUrl).hostname.search(\"163.com\") !== -1) {\n            window.location.href = redirectUrl;\n        } else if (redirectUrl.search(\"163.com\") !== -1){\n            window.location.href = redirectUrl;\n        };\n    }\n\n    // Forward To Redirect Url End\n    if ((isWeixin || isQQ) && isAndroid) {\n        window.location.href = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.netease.newsreader.activity&ckey=CK1331205846719&android_schema=' +　url.match(/(.*)\\?/)[1]\n    }\n\n    if(isIos||isIpad){\n        document.getElementById(\"guide\").classList.add('iosguideopen')\n    }else if (isAndroid){\n        document.getElementById(\"guide\").classList.add('androidguideopen')\n    }else{\n        // window.location.href = 'http://www.163.com/newsapp'\n    }\n\n    document.getElementById('link').addEventListener('click', function(){\n\n        // 统计\n        neteaseTracker && neteaseTracker(false,'http://sps.163.com/func/?func=downloadapp&modelid='+modelid+'&spst='+spst+'&spsf&spss=' + channel,'', 'sps' )\n\n        if (config) {\n            android_url = config.android\n        }\n        if (config && config.iOS) {\n            ios_url = config.iOS\n        }\n        if(isWeixin || isQQ){\n            return\n        }\n        var msg = isIDeviceIpad ? \"检测到您正在使用iPad, 是否直接前往AppStore下载?\" : \"检测到您正在使用iPhone, 是否直接前往AppStore下载?\";\n        if (isIDevice){\n            window.location = ios_url;\n            return;\n        }else if(isAndroid){\n            // uc浏览器用iframe唤醒\n            if(navigator.userAgent.match(/ucbrowser|yixin|MailMaster/i)){\n                document.getElementById('iframe').src = url;\n            } else {\n                window.location.href = url;\n            }\n            setTimeout(function(){\n                if(document.webkitHidden) {\n                    return\n                }\n                if (confirm(\"检测到您正在使用Android 手机，是否直接下载程序安装包？\")) {\n                    neteaseTracker && neteaseTracker(false,'http://sps.163.com/func/?func=downloadapp_pass&modelid='+modelid+'&spst='+spst+'&spsf&spss=' + channel,'', 'sps' )\n                    window.location.href = android_url;\n                } else {\n                    neteaseTracker && neteaseTracker(false,'http://sps.163.com/func/?func=downloadapp_cancel&modelid='+modelid+'&spst='+spst+'&spsf&spss=' + channel,'', 'sps' )\n                }\n            },200)\n            return;\n        }else if(isIEMobile){\n            window.location = wphone_url;\n            return;\n        }else{\n            window.open('http://www.163.com/special/00774IQ6/newsapp_download.html');\n            return;\n        }\n    }, false)\n\n    setTimeout(function(){\n        if(isIDevice && params.notdownload != 1 && !isNewsapp && !isIos9){\n            document.getElementById('link').click()\n        }\n    }, 1000)\n\n})(window,document);\n虽然有一些外部的引用，和一些搞不懂是干什么用的方法和变量，但是基本逻辑还是能够看明白。好像也没有什么特别的地方。研究了许久，看到了一个jsonp请求很奇特。这是来干嘛用的？\n\n于是费尽千辛万苦，搜索了很多文章，最终锁定了一个关键的名词 Universal links。\n\n如果我早知道这个名词，那么问题就不会变的那么束手无策。所以这个东西是什么呢？\n\nApple为iOS 9发布了一个所谓的通用链接的深层链接特性，即Universal links。虽然它并不完美，但是这一发布，让数以千计的应用开发人员突然意识到自己的应用体验被打破。\n\nUniversal links，一种能够方便的通过传统的HTTP/HTTPS 链接来启动App，使用相同的网址打开网站和App。\n\n关于这个问题的提问与universal links的介绍 点击这里查看\n\nios9推行的一个新的协议！\n\n关于本文的这个问题，国内的论坛有许许多多的文章来解决，但是提到universal  links的文章少之又少，而我想吐槽的是，我们的ios开发也尼玛不知道这个名词，搞什么鬼。他改变了用户体验的关键在于，微信没有屏蔽这个协议。因此 如果我们的app注册了这个协议，那么我们就能够从微信中直接唤起app。\n\n这个时候我就发现，上面贴的网易新闻代码中的jsonp请求的内容，就是这个协议必须的一个叫做apple-app-site-association的JSON文件\n\n{\n   \"applinks\": {\n       \"apps\": [ ],\n       \"details\": {\n           \"TEAM-IDENTIFIER.YOUR.BUNDLE.IDENTIFIER\": {\n               \"paths\": [\n                   \"*\"\n               ]\n           }\n       }\n   }\n}\n大家可以直接访问这个链接，查看里面的内容\n\nhttp://active.163.com/service/form/v1/5847/view/1047.jsonp\n\n至于universal links具体如何实现，让ios的同学去搞定吧，这里提供两个参考文章\n\nhttp://www.cocoachina.com/bbs/read.php?tid-1486368.html\n\nhttps://blog.branch.io/how-to-setup-universal-links-to-deep-link-on-apple-ios-9\n\n支持了这个协议之后，我们又可以通过iframe来唤起app了，因此基本逻辑就是这样了。最终的调研结果是\n\n没有完美的解决方案\n\n就算是网易新闻，这个按钮在使用过程中也会有一些小bug，无法做到完美的状态。\n\n因为我们面临许多没办法解决的问题，比如无法真正意义上的判断本地是否安装了app，pageshow，pagehide并不是所有的浏览器都支持等。很多其他博客里面，什么计算时间差等方案，根！本！没！有！用！我还花了很久的时间去研究这个方案。\n\n老实说，从微信中跳转到外部浏览器，并不是一个好的解决方案，这样会导致很多用户流失，因此大家都在ios上实现了universal links，而我更加倾向的方案是知乎的解决，他们从设计上避免了在一个按钮上来判断这个逻辑，而采用了两个按钮的方式。\n\n网易新闻的逻辑是，点击打开会调整到一个下载页面，这个下载页面一加载完成就尝试打开app，如果打开了就直接跑到app里面去了，如果没有就在页面上有一个立即下载的按钮，按钮行只有下载处理。\n\n这个问题就总结到这里，如果大家有更好的方案，欢迎与我沟通。","slug":"second","published":1,"updated":"2016-09-19T07:53:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"citb6ip970002z98zesesro3q","content":"<p><img src=\"../../public/images/background-cover.jpg\" alt=\"Mou icon\"></p>\n<p>前段时间遇到一个小需求：要求在分享出来的h5页面中，有一个立即打开的按钮，如果本地安装了我们的app，那么点击就直接唤起本地app，如果没有安装，则跳转到下载。</p>\n<p>因为从来没有做过这个需求，因此这注定是一个苦逼的调研过程。</p>\n<p>我们最开始就面临2个问题：一是如何唤起本地app，二是如何判断浏览器是否安装了对应app。</p>\n<p>如何唤起本地app</p>\n<p>首先，想要实现这个需求，肯定是必须要客户端同学的配合才行，因此我们不用知道所有的实现细节，我们从前端角度思考看这个问题，需要知道的一点是，ios与Android都支持一种叫做schema协议的链接。比如网易新闻客户端的协议为</p>\n<p>newsapp://xxxxx<br>当然，这个协议不需要我们前端去实现，我们只需要将协议放在a标签的href属性里，或者使用location.href与iframe来实现激活这个链接。而location.href与iframe是解决这个需求的关键。</p>\n<p>在ios中，还支持通过smart app banner来唤起app，即通过一个meta标签，在标签里带上app的信息，和打开后的行为，代码形如</p>\n<p><meta name=\"apple-itunes-app\" content=\"app-id=1023600494, app-argument=tigerbrokersusstock://com.tigerbrokers.usstock/post?postId=7125\"><br>我们还需要知道的一点是，微信里屏蔽了schema协议。除非你是微信的合作伙伴之类的，他们专门给你配置进白名单。否则我们就没办法通过这个协议在微信中直接唤起app。</p>\n<p>因此我们会判断页面场景是否在微信中，如果在微信中，则会提示用户在浏览器中打开。</p>\n<p>如何判断本地是否安装了app</p>\n<p>首先我们可以确认的是，在浏览器中无法明确的判断本地是否安装了app。因此我们必须采取一些取巧的思路来解决这个问题。</p>\n<p>我们能够很容易想到，采用设置一个延迟定时器setTimeout的方式，第一时间尝试唤起app，如果200ms没有唤起成功，则默认本地没有安装app，200ms以后，将会触发下载行为。</p>\n<p>结合这个思路，我们来全局考虑一下这个需求应该采用什么样的方案来实现它。</p>\n<p>使用location.href的同学可能会面临一个担忧，在有的浏览器中，当我们尝试激活schema link的时候，若本地没有安装app，则会跳转到一个浏览器默认的错误页面去了。因此大多数人采用的解决方案都是使用iframe</p>\n<p>测试了很多浏览器，没有发现过这种情况</p>\n<p>后来观察了网易新闻，今日头条，YY等的实现方案，发现大家都采用的是iframe来实现。好吧，面对这种情况，只能屈服。</p>\n<p>整理一下目前的思路，得到下面的解决方案</p>\n<p>var url = {<br>  open: ‘app://xxxxx’,<br>  down: ‘xxxxxxxx’<br>};<br>var iframe = document.createElement(‘iframe’);<br>var body = document.body;<br>iframe.style.cssText=’display:none;width=0;height=0’;<br>var timer = null;</p>\n<p>// 立即打开的按钮<br>var openapp = document.getElementById(‘openapp’);<br>openapp.addEventListener(‘click’, function() {<br>  if(/MicroMessenger/gi.test(navigator.userAgent) {<br>    // 引导用户在浏览器中打开<br>  }) else{<br>    body.appendChild(iframe);<br>    iframe.src = url.open;<br>    timer = setTimeout(function() {<br>      wondow.location.href = url.down;<br>    }, 500);<br>  }<br>}, false)<br>想法很美好，现实很残酷。一测试，就发现简单的这样实现有许多的问题。</p>\n<p>第一个问题在于，当页面成功唤起app之后，我们再切换回来浏览器，发现跳转到了下载页面。</p>\n<p>为了解决这个问题，发现各个公司都进行了不同方式的尝试。</p>\n<p>也是历经的很多折磨，发现了几个比较有用的事件。</p>\n<p>pageshow： 页面显示时触发，在load事件之后触发。需要将该事件绑定到window上才会触发</p>\n<p>pagehide: 页面隐藏时触发</p>\n<p>visibilitychange： 页面隐藏没有在当前显示时触发，比如切换tab，也会触发该事件</p>\n<p>document.hidden 当页面隐藏时，该值为true，显示时为false</p>\n<p>由于各个浏览器的支持情况不同，我们需要将这些事件都给绑定上，即使这样，也不一定能够保证所有的浏览器都能够解决掉这个小问题，实在没办法的事情就不管了。</p>\n<p>因此需要扩充一下上面的方案，当本地app被唤起，则页面会隐藏掉，就会触发pagehide与visibilitychange事件</p>\n<p>$(document).on(‘visibilitychange webkitvisibilitychange’, function() {<br>    var tag = document.hidden || document.webkitHidden;<br>    if (tag) {<br>        clearTimeout(timer);<br>    }<br>})</p>\n<p>$(window).on(‘pagehide’, function() {<br>    clearTimeout(timer);<br>})<br>而另外一个问题就是IOS9+下面的问题了。ios9的Safari，根本不支持通过iframe跳转到其他页面去。也就是说，在safari下，我的整体方案被全盘否决！</p>\n<p>于是我就只能尝试使用location.href的方式，这个方式能够唤起app，但是有一个坑爹的问题，使用schema协议唤起app会有弹窗而不会直接跳转去app！甚至当本地没有app时，会被判断为链接无效，然后还有一个弹窗。</p>\n<p>这个弹窗会造成什么问题呢？如果用户不点确认按钮，根据上面的逻辑，这个时候就会发现页面会自动跳转到下载去了。而且无效的弹窗提示在用户体验上是不允许出现的。</p>\n<p>好吧，继续扒别人的代码，看看别人是如何实现的。然后我又去观摩了其他公司的实现结果，发现网易新闻，今日头条都可以在ios直接从微信中唤起 app。真是神奇了，可是今日头条在Android版微信上也没办法直接唤起的，他们在Android上都是直接到腾讯应用宝的下载里去。所以按道理来说 这不是添加了白名单。</p>\n<p>为了找到这个问题的解决方案，我在网易新闻的页面中扒出了他们的代码，并整理如下，添加了部分注释</p>\n<p>window.NRUM = window.NRUM || {};<br>window.NRUM.config = {<br>    key:’27e86c0843344caca7ba9ea652d7948d’,<br>    clientStart: +new Date()<br>};<br>(function() {<br>    var n = document.getElementsByTagName(‘script’)[0],<br>        s = document.createElement(‘script’);</p>\n<pre><code>s.type = &apos;text/javascript&apos;;\ns.async = true;\ns.src = &apos;//nos.netease.com/apmsdk/napm-web-min-1.1.3.js&apos;;\nn.parentNode.insertBefore(s, n);\n</code></pre><p>})();</p>\n<p>;<br>(function(window,doc){</p>\n<pre><code>// http://apm.netease.com/manual?api=web\nNRUM.mark &amp;&amp; NRUM.mark(&apos;pageload&apos;, true)\n\nvar list = []\nvar config = null\n\n// jsonp\nfunction jsonp(a, b, c) {\n    var d;\n    d = document.createElement(&apos;script&apos;);\n    d.src = a;\n    c &amp;&amp; (d.charset = c);\n    d.onload = function() {\n        this.onload = this.onerror = null;\n        this.parentNode.removeChild(this);\n        b &amp;&amp; b(!0);\n    };\n    d.onerror = function() {\n        this.onload = this.onerror = null;\n        this.parentNode.removeChild(this);\n        b &amp;&amp; b(!1);\n    };\n    document.head.appendChild(d);\n};\n\n\nfunction localParam(search,hash){\n    search = search || window.location.search;\n    hash = hash || window.location.hash;\n    var fn = function(str,reg){\n        if(str){\n            var data = {};\n            str.replace(reg,function( $0, $1, $2, $3 ){\n                data[ $1 ] = $3;\n            });\n            return data;\n        }\n    }\n    return {search: fn(search,new RegExp( &quot;([^?=&amp;]+)(=([^&amp;]*))?&quot;, &quot;g&quot; ))||{},hash: fn(hash,new RegExp( &quot;([^#=&amp;]+)(=([^&amp;]*))?&quot;, &quot;g&quot; ))||{}};\n}\n\njsonp(&apos;http://active.163.com/service/form/v1/5847/view/1047.jsonp&apos;)\n\nwindow.search = localParam().search\nwindow._callback = function(data) {\n    window._callback = null\n    list = data.list\n    if(search.s &amp;&amp; !!search.s.match(/^wap/i)) {\n        config = list.filter(function(item){\n            return item.type === &apos;wap&apos;\n        })[0]\n        return\n    }\n    config = list.filter(function(item){\n        return item.type === search.s\n    })[0]\n}\n\nvar isAndroid = !!navigator.userAgent.match(/android/ig),\n    isIos = !!navigator.userAgent.match(/iphone|ipod/ig),\n    isIpad = !!navigator.userAgent.match(/ipad/ig),\n    isIos9 = !!navigator.userAgent.match(/OS 9/ig),\n    isYx = !!navigator.userAgent.match(/MailMaster_Android/i),\n    isNewsapp = !!navigator.userAgent.match(/newsapp/i),\n    isWeixin = (/MicroMessenger/ig).test(navigator.userAgent),\n    isYixin = (/yixin/ig).test(navigator.userAgent),\n    isQQ = (/qq/ig).test(navigator.userAgent),\n    params = localParam().search,\n    url = &apos;newsapp://&apos;,\n    iframe = document.getElementById(&apos;iframe&apos;);\n\nvar isIDevicePhone = (/iphone|ipod/gi).test(navigator.platform);\nvar isIDeviceIpad = !isIDevicePhone &amp;&amp; (/ipad/gi).test(navigator.platform);\nvar isIDevice = isIDevicePhone || isIDeviceIpad;\nvar isandroid2_x = !isIDevice &amp;&amp; (/android\\s?2\\./gi).test(navigator.userAgent);\nvar isIEMobile = !isIDevice &amp;&amp; !isAndroid &amp;&amp; (/MSIE/gi).test(navigator.userAgent);\nvar android_url = (!isandroid2_x) ? &quot;http://3g.163.com/links/4304&quot; : &quot;http://3g.163.com/links/6264&quot;;\nvar ios_url = &quot;http://3g.163.com/links/3615&quot;;\nvar wphone_url = &quot;http://3g.163.com/links/3614&quot;;\nvar channel = params.s || &apos;newsapp&apos;\n\n// 判断在不同环境下app的url\nif(params.docid){\n    if(params[&apos;boardid&apos;] &amp;&amp; params[&apos;title&apos;]){\n        url = url + &apos;comment/&apos; + params.boardid + &apos;/&apos; + params.docid + &apos;/&apos; + params.title\n    }else{\n        url = url + &apos;doc/&apos; + params.docid\n    }\n}else if(params.sid){\n    url = url + &apos;topic/&apos; + params.sid\n}else if(params.pid){\n    var pid = params.pid.split(&apos;_&apos;)\n    url = url + &apos;photo/&apos; + pid[0] + &apos;/&apos; + pid[1]\n}else if(params.vid){\n    url = url + &apos;video/&apos; + params.vid\n}else if(params.liveRoomid){\n    url = url + &apos;live/&apos; + params.liveRoomid\n}else if(params.url){\n    url = url + &apos;web/&apos; + decodeURIComponent(params.url)\n}else if(params.expertid){\n    url = url + &apos;expert/&apos; + params.expertid\n}else if(params.subjectid){\n    url = url + &apos;subject/&apos; + params.subjectid\n}else if(params.readerid){\n    url = url + &apos;reader/&apos; + params.readerid\n}else{\n    url += &apos;startup&apos;\n}\nif(url.indexOf(&apos;?&apos;) &gt;= 0){\n    url += &apos;&amp;s=&apos; + (params.s || &apos;sps&apos;)\n}else{\n    url += &apos;?s=&apos; + (params.s || &apos;sps&apos;)\n}\n\n// ios &amp;&amp; 易信  用iframe 打开\nif((isIos||isIpad) &amp;&amp; navigator.userAgent.match(/yixin/i)) {\n    document.getElementById(&apos;iframe&apos;).src = url;\n}\n\nvar height = document.documentElement.clientHeight;\n\n// 通常情况下先尝试使用iframe打开\ndocument.getElementById(&apos;iframe&apos;).src = url;\n\n// 移动端浏览器中，将下载页面显示出来\nif(!isWeixin &amp;&amp; !isQQ &amp;&amp; !isYixin &amp;&amp; !isYx){\n    document.querySelector(&apos;.main-body&apos;).style.display = &apos;block&apos;\n    if(isIos9){\n        document.querySelector(&apos;.main-body&apos;).classList.add(&apos;showtip&apos;)\n    }\n\n    setTimeout(function(){\n        document.body.scrollTop = 0\n    },200)\n}else{\n    document.getElementById(&apos;guide&apos;).style.display = &apos;block&apos;\n}\n\n// Forward To Redirect Url\n// Add by zhanzhixiang 12/28/2015\nif (params.redirect) {\n    var redirectUrl = decodeURIComponent(params.redirect);\n    if ( typeof(URL) === &apos;function&apos; &amp;&amp; new URL(redirectUrl).hostname.search(&quot;163.com&quot;) !== -1) {\n        window.location.href = redirectUrl;\n    } else if (redirectUrl.search(&quot;163.com&quot;) !== -1){\n        window.location.href = redirectUrl;\n    };\n}\n\n// Forward To Redirect Url End\nif ((isWeixin || isQQ) &amp;&amp; isAndroid) {\n    window.location.href = &apos;http://a.app.qq.com/o/simple.jsp?pkgname=com.netease.newsreader.activity&amp;ckey=CK1331205846719&amp;android_schema=&apos; +　url.match(/(.*)\\?/)[1]\n}\n\nif(isIos||isIpad){\n    document.getElementById(&quot;guide&quot;).classList.add(&apos;iosguideopen&apos;)\n}else if (isAndroid){\n    document.getElementById(&quot;guide&quot;).classList.add(&apos;androidguideopen&apos;)\n}else{\n    // window.location.href = &apos;http://www.163.com/newsapp&apos;\n}\n\ndocument.getElementById(&apos;link&apos;).addEventListener(&apos;click&apos;, function(){\n\n    // 统计\n    neteaseTracker &amp;&amp; neteaseTracker(false,&apos;http://sps.163.com/func/?func=downloadapp&amp;modelid=&apos;+modelid+&apos;&amp;spst=&apos;+spst+&apos;&amp;spsf&amp;spss=&apos; + channel,&apos;&apos;, &apos;sps&apos; )\n\n    if (config) {\n        android_url = config.android\n    }\n    if (config &amp;&amp; config.iOS) {\n        ios_url = config.iOS\n    }\n    if(isWeixin || isQQ){\n        return\n    }\n    var msg = isIDeviceIpad ? &quot;检测到您正在使用iPad, 是否直接前往AppStore下载?&quot; : &quot;检测到您正在使用iPhone, 是否直接前往AppStore下载?&quot;;\n    if (isIDevice){\n        window.location = ios_url;\n        return;\n    }else if(isAndroid){\n        // uc浏览器用iframe唤醒\n        if(navigator.userAgent.match(/ucbrowser|yixin|MailMaster/i)){\n            document.getElementById(&apos;iframe&apos;).src = url;\n        } else {\n            window.location.href = url;\n        }\n        setTimeout(function(){\n            if(document.webkitHidden) {\n                return\n            }\n            if (confirm(&quot;检测到您正在使用Android 手机，是否直接下载程序安装包？&quot;)) {\n                neteaseTracker &amp;&amp; neteaseTracker(false,&apos;http://sps.163.com/func/?func=downloadapp_pass&amp;modelid=&apos;+modelid+&apos;&amp;spst=&apos;+spst+&apos;&amp;spsf&amp;spss=&apos; + channel,&apos;&apos;, &apos;sps&apos; )\n                window.location.href = android_url;\n            } else {\n                neteaseTracker &amp;&amp; neteaseTracker(false,&apos;http://sps.163.com/func/?func=downloadapp_cancel&amp;modelid=&apos;+modelid+&apos;&amp;spst=&apos;+spst+&apos;&amp;spsf&amp;spss=&apos; + channel,&apos;&apos;, &apos;sps&apos; )\n            }\n        },200)\n        return;\n    }else if(isIEMobile){\n        window.location = wphone_url;\n        return;\n    }else{\n        window.open(&apos;http://www.163.com/special/00774IQ6/newsapp_download.html&apos;);\n        return;\n    }\n}, false)\n\nsetTimeout(function(){\n    if(isIDevice &amp;&amp; params.notdownload != 1 &amp;&amp; !isNewsapp &amp;&amp; !isIos9){\n        document.getElementById(&apos;link&apos;).click()\n    }\n}, 1000)\n</code></pre><p>})(window,document);<br>虽然有一些外部的引用，和一些搞不懂是干什么用的方法和变量，但是基本逻辑还是能够看明白。好像也没有什么特别的地方。研究了许久，看到了一个jsonp请求很奇特。这是来干嘛用的？</p>\n<p>于是费尽千辛万苦，搜索了很多文章，最终锁定了一个关键的名词 Universal links。</p>\n<p>如果我早知道这个名词，那么问题就不会变的那么束手无策。所以这个东西是什么呢？</p>\n<p>Apple为iOS 9发布了一个所谓的通用链接的深层链接特性，即Universal links。虽然它并不完美，但是这一发布，让数以千计的应用开发人员突然意识到自己的应用体验被打破。</p>\n<p>Universal links，一种能够方便的通过传统的HTTP/HTTPS 链接来启动App，使用相同的网址打开网站和App。</p>\n<p>关于这个问题的提问与universal links的介绍 点击这里查看</p>\n<p>ios9推行的一个新的协议！</p>\n<p>关于本文的这个问题，国内的论坛有许许多多的文章来解决，但是提到universal  links的文章少之又少，而我想吐槽的是，我们的ios开发也尼玛不知道这个名词，搞什么鬼。他改变了用户体验的关键在于，微信没有屏蔽这个协议。因此 如果我们的app注册了这个协议，那么我们就能够从微信中直接唤起app。</p>\n<p>这个时候我就发现，上面贴的网易新闻代码中的jsonp请求的内容，就是这个协议必须的一个叫做apple-app-site-association的JSON文件</p>\n<p>{<br>   “applinks”: {<br>       “apps”: [ ],<br>       “details”: {<br>           “TEAM-IDENTIFIER.YOUR.BUNDLE.IDENTIFIER”: {<br>               “paths”: [<br>                   “*”<br>               ]<br>           }<br>       }<br>   }<br>}<br>大家可以直接访问这个链接，查看里面的内容</p>\n<p><a href=\"http://active.163.com/service/form/v1/5847/view/1047.jsonp\" target=\"_blank\" rel=\"external\">http://active.163.com/service/form/v1/5847/view/1047.jsonp</a></p>\n<p>至于universal links具体如何实现，让ios的同学去搞定吧，这里提供两个参考文章</p>\n<p><a href=\"http://www.cocoachina.com/bbs/read.php?tid-1486368.html\" target=\"_blank\" rel=\"external\">http://www.cocoachina.com/bbs/read.php?tid-1486368.html</a></p>\n<p><a href=\"https://blog.branch.io/how-to-setup-universal-links-to-deep-link-on-apple-ios-9\" target=\"_blank\" rel=\"external\">https://blog.branch.io/how-to-setup-universal-links-to-deep-link-on-apple-ios-9</a></p>\n<p>支持了这个协议之后，我们又可以通过iframe来唤起app了，因此基本逻辑就是这样了。最终的调研结果是</p>\n<p>没有完美的解决方案</p>\n<p>就算是网易新闻，这个按钮在使用过程中也会有一些小bug，无法做到完美的状态。</p>\n<p>因为我们面临许多没办法解决的问题，比如无法真正意义上的判断本地是否安装了app，pageshow，pagehide并不是所有的浏览器都支持等。很多其他博客里面，什么计算时间差等方案，根！本！没！有！用！我还花了很久的时间去研究这个方案。</p>\n<p>老实说，从微信中跳转到外部浏览器，并不是一个好的解决方案，这样会导致很多用户流失，因此大家都在ios上实现了universal links，而我更加倾向的方案是知乎的解决，他们从设计上避免了在一个按钮上来判断这个逻辑，而采用了两个按钮的方式。</p>\n<p>网易新闻的逻辑是，点击打开会调整到一个下载页面，这个下载页面一加载完成就尝试打开app，如果打开了就直接跑到app里面去了，如果没有就在页面上有一个立即下载的按钮，按钮行只有下载处理。</p>\n<p>这个问题就总结到这里，如果大家有更好的方案，欢迎与我沟通。</p>\n","excerpt":"","more":"<p><img src=\"../../public/images/background-cover.jpg\" alt=\"Mou icon\"></p>\n<p>前段时间遇到一个小需求：要求在分享出来的h5页面中，有一个立即打开的按钮，如果本地安装了我们的app，那么点击就直接唤起本地app，如果没有安装，则跳转到下载。</p>\n<p>因为从来没有做过这个需求，因此这注定是一个苦逼的调研过程。</p>\n<p>我们最开始就面临2个问题：一是如何唤起本地app，二是如何判断浏览器是否安装了对应app。</p>\n<p>如何唤起本地app</p>\n<p>首先，想要实现这个需求，肯定是必须要客户端同学的配合才行，因此我们不用知道所有的实现细节，我们从前端角度思考看这个问题，需要知道的一点是，ios与Android都支持一种叫做schema协议的链接。比如网易新闻客户端的协议为</p>\n<p>newsapp://xxxxx<br>当然，这个协议不需要我们前端去实现，我们只需要将协议放在a标签的href属性里，或者使用location.href与iframe来实现激活这个链接。而location.href与iframe是解决这个需求的关键。</p>\n<p>在ios中，还支持通过smart app banner来唤起app，即通过一个meta标签，在标签里带上app的信息，和打开后的行为，代码形如</p>\n<p><meta name=\"apple-itunes-app\" content=\"app-id=1023600494, app-argument=tigerbrokersusstock://com.tigerbrokers.usstock/post?postId=7125\" /><br>我们还需要知道的一点是，微信里屏蔽了schema协议。除非你是微信的合作伙伴之类的，他们专门给你配置进白名单。否则我们就没办法通过这个协议在微信中直接唤起app。</p>\n<p>因此我们会判断页面场景是否在微信中，如果在微信中，则会提示用户在浏览器中打开。</p>\n<p>如何判断本地是否安装了app</p>\n<p>首先我们可以确认的是，在浏览器中无法明确的判断本地是否安装了app。因此我们必须采取一些取巧的思路来解决这个问题。</p>\n<p>我们能够很容易想到，采用设置一个延迟定时器setTimeout的方式，第一时间尝试唤起app，如果200ms没有唤起成功，则默认本地没有安装app，200ms以后，将会触发下载行为。</p>\n<p>结合这个思路，我们来全局考虑一下这个需求应该采用什么样的方案来实现它。</p>\n<p>使用location.href的同学可能会面临一个担忧，在有的浏览器中，当我们尝试激活schema link的时候，若本地没有安装app，则会跳转到一个浏览器默认的错误页面去了。因此大多数人采用的解决方案都是使用iframe</p>\n<p>测试了很多浏览器，没有发现过这种情况</p>\n<p>后来观察了网易新闻，今日头条，YY等的实现方案，发现大家都采用的是iframe来实现。好吧，面对这种情况，只能屈服。</p>\n<p>整理一下目前的思路，得到下面的解决方案</p>\n<p>var url = {<br>  open: ‘app://xxxxx’,<br>  down: ‘xxxxxxxx’<br>};<br>var iframe = document.createElement(‘iframe’);<br>var body = document.body;<br>iframe.style.cssText=’display:none;width=0;height=0’;<br>var timer = null;</p>\n<p>// 立即打开的按钮<br>var openapp = document.getElementById(‘openapp’);<br>openapp.addEventListener(‘click’, function() {<br>  if(/MicroMessenger/gi.test(navigator.userAgent) {<br>    // 引导用户在浏览器中打开<br>  }) else{<br>    body.appendChild(iframe);<br>    iframe.src = url.open;<br>    timer = setTimeout(function() {<br>      wondow.location.href = url.down;<br>    }, 500);<br>  }<br>}, false)<br>想法很美好，现实很残酷。一测试，就发现简单的这样实现有许多的问题。</p>\n<p>第一个问题在于，当页面成功唤起app之后，我们再切换回来浏览器，发现跳转到了下载页面。</p>\n<p>为了解决这个问题，发现各个公司都进行了不同方式的尝试。</p>\n<p>也是历经的很多折磨，发现了几个比较有用的事件。</p>\n<p>pageshow： 页面显示时触发，在load事件之后触发。需要将该事件绑定到window上才会触发</p>\n<p>pagehide: 页面隐藏时触发</p>\n<p>visibilitychange： 页面隐藏没有在当前显示时触发，比如切换tab，也会触发该事件</p>\n<p>document.hidden 当页面隐藏时，该值为true，显示时为false</p>\n<p>由于各个浏览器的支持情况不同，我们需要将这些事件都给绑定上，即使这样，也不一定能够保证所有的浏览器都能够解决掉这个小问题，实在没办法的事情就不管了。</p>\n<p>因此需要扩充一下上面的方案，当本地app被唤起，则页面会隐藏掉，就会触发pagehide与visibilitychange事件</p>\n<p>$(document).on(‘visibilitychange webkitvisibilitychange’, function() {<br>    var tag = document.hidden || document.webkitHidden;<br>    if (tag) {<br>        clearTimeout(timer);<br>    }<br>})</p>\n<p>$(window).on(‘pagehide’, function() {<br>    clearTimeout(timer);<br>})<br>而另外一个问题就是IOS9+下面的问题了。ios9的Safari，根本不支持通过iframe跳转到其他页面去。也就是说，在safari下，我的整体方案被全盘否决！</p>\n<p>于是我就只能尝试使用location.href的方式，这个方式能够唤起app，但是有一个坑爹的问题，使用schema协议唤起app会有弹窗而不会直接跳转去app！甚至当本地没有app时，会被判断为链接无效，然后还有一个弹窗。</p>\n<p>这个弹窗会造成什么问题呢？如果用户不点确认按钮，根据上面的逻辑，这个时候就会发现页面会自动跳转到下载去了。而且无效的弹窗提示在用户体验上是不允许出现的。</p>\n<p>好吧，继续扒别人的代码，看看别人是如何实现的。然后我又去观摩了其他公司的实现结果，发现网易新闻，今日头条都可以在ios直接从微信中唤起 app。真是神奇了，可是今日头条在Android版微信上也没办法直接唤起的，他们在Android上都是直接到腾讯应用宝的下载里去。所以按道理来说 这不是添加了白名单。</p>\n<p>为了找到这个问题的解决方案，我在网易新闻的页面中扒出了他们的代码，并整理如下，添加了部分注释</p>\n<p>window.NRUM = window.NRUM || {};<br>window.NRUM.config = {<br>    key:’27e86c0843344caca7ba9ea652d7948d’,<br>    clientStart: +new Date()<br>};<br>(function() {<br>    var n = document.getElementsByTagName(‘script’)[0],<br>        s = document.createElement(‘script’);</p>\n<pre><code>s.type = &apos;text/javascript&apos;;\ns.async = true;\ns.src = &apos;//nos.netease.com/apmsdk/napm-web-min-1.1.3.js&apos;;\nn.parentNode.insertBefore(s, n);\n</code></pre><p>})();</p>\n<p>;<br>(function(window,doc){</p>\n<pre><code>// http://apm.netease.com/manual?api=web\nNRUM.mark &amp;&amp; NRUM.mark(&apos;pageload&apos;, true)\n\nvar list = []\nvar config = null\n\n// jsonp\nfunction jsonp(a, b, c) {\n    var d;\n    d = document.createElement(&apos;script&apos;);\n    d.src = a;\n    c &amp;&amp; (d.charset = c);\n    d.onload = function() {\n        this.onload = this.onerror = null;\n        this.parentNode.removeChild(this);\n        b &amp;&amp; b(!0);\n    };\n    d.onerror = function() {\n        this.onload = this.onerror = null;\n        this.parentNode.removeChild(this);\n        b &amp;&amp; b(!1);\n    };\n    document.head.appendChild(d);\n};\n\n\nfunction localParam(search,hash){\n    search = search || window.location.search;\n    hash = hash || window.location.hash;\n    var fn = function(str,reg){\n        if(str){\n            var data = {};\n            str.replace(reg,function( $0, $1, $2, $3 ){\n                data[ $1 ] = $3;\n            });\n            return data;\n        }\n    }\n    return {search: fn(search,new RegExp( &quot;([^?=&amp;]+)(=([^&amp;]*))?&quot;, &quot;g&quot; ))||{},hash: fn(hash,new RegExp( &quot;([^#=&amp;]+)(=([^&amp;]*))?&quot;, &quot;g&quot; ))||{}};\n}\n\njsonp(&apos;http://active.163.com/service/form/v1/5847/view/1047.jsonp&apos;)\n\nwindow.search = localParam().search\nwindow._callback = function(data) {\n    window._callback = null\n    list = data.list\n    if(search.s &amp;&amp; !!search.s.match(/^wap/i)) {\n        config = list.filter(function(item){\n            return item.type === &apos;wap&apos;\n        })[0]\n        return\n    }\n    config = list.filter(function(item){\n        return item.type === search.s\n    })[0]\n}\n\nvar isAndroid = !!navigator.userAgent.match(/android/ig),\n    isIos = !!navigator.userAgent.match(/iphone|ipod/ig),\n    isIpad = !!navigator.userAgent.match(/ipad/ig),\n    isIos9 = !!navigator.userAgent.match(/OS 9/ig),\n    isYx = !!navigator.userAgent.match(/MailMaster_Android/i),\n    isNewsapp = !!navigator.userAgent.match(/newsapp/i),\n    isWeixin = (/MicroMessenger/ig).test(navigator.userAgent),\n    isYixin = (/yixin/ig).test(navigator.userAgent),\n    isQQ = (/qq/ig).test(navigator.userAgent),\n    params = localParam().search,\n    url = &apos;newsapp://&apos;,\n    iframe = document.getElementById(&apos;iframe&apos;);\n\nvar isIDevicePhone = (/iphone|ipod/gi).test(navigator.platform);\nvar isIDeviceIpad = !isIDevicePhone &amp;&amp; (/ipad/gi).test(navigator.platform);\nvar isIDevice = isIDevicePhone || isIDeviceIpad;\nvar isandroid2_x = !isIDevice &amp;&amp; (/android\\s?2\\./gi).test(navigator.userAgent);\nvar isIEMobile = !isIDevice &amp;&amp; !isAndroid &amp;&amp; (/MSIE/gi).test(navigator.userAgent);\nvar android_url = (!isandroid2_x) ? &quot;http://3g.163.com/links/4304&quot; : &quot;http://3g.163.com/links/6264&quot;;\nvar ios_url = &quot;http://3g.163.com/links/3615&quot;;\nvar wphone_url = &quot;http://3g.163.com/links/3614&quot;;\nvar channel = params.s || &apos;newsapp&apos;\n\n// 判断在不同环境下app的url\nif(params.docid){\n    if(params[&apos;boardid&apos;] &amp;&amp; params[&apos;title&apos;]){\n        url = url + &apos;comment/&apos; + params.boardid + &apos;/&apos; + params.docid + &apos;/&apos; + params.title\n    }else{\n        url = url + &apos;doc/&apos; + params.docid\n    }\n}else if(params.sid){\n    url = url + &apos;topic/&apos; + params.sid\n}else if(params.pid){\n    var pid = params.pid.split(&apos;_&apos;)\n    url = url + &apos;photo/&apos; + pid[0] + &apos;/&apos; + pid[1]\n}else if(params.vid){\n    url = url + &apos;video/&apos; + params.vid\n}else if(params.liveRoomid){\n    url = url + &apos;live/&apos; + params.liveRoomid\n}else if(params.url){\n    url = url + &apos;web/&apos; + decodeURIComponent(params.url)\n}else if(params.expertid){\n    url = url + &apos;expert/&apos; + params.expertid\n}else if(params.subjectid){\n    url = url + &apos;subject/&apos; + params.subjectid\n}else if(params.readerid){\n    url = url + &apos;reader/&apos; + params.readerid\n}else{\n    url += &apos;startup&apos;\n}\nif(url.indexOf(&apos;?&apos;) &gt;= 0){\n    url += &apos;&amp;s=&apos; + (params.s || &apos;sps&apos;)\n}else{\n    url += &apos;?s=&apos; + (params.s || &apos;sps&apos;)\n}\n\n// ios &amp;&amp; 易信  用iframe 打开\nif((isIos||isIpad) &amp;&amp; navigator.userAgent.match(/yixin/i)) {\n    document.getElementById(&apos;iframe&apos;).src = url;\n}\n\nvar height = document.documentElement.clientHeight;\n\n// 通常情况下先尝试使用iframe打开\ndocument.getElementById(&apos;iframe&apos;).src = url;\n\n// 移动端浏览器中，将下载页面显示出来\nif(!isWeixin &amp;&amp; !isQQ &amp;&amp; !isYixin &amp;&amp; !isYx){\n    document.querySelector(&apos;.main-body&apos;).style.display = &apos;block&apos;\n    if(isIos9){\n        document.querySelector(&apos;.main-body&apos;).classList.add(&apos;showtip&apos;)\n    }\n\n    setTimeout(function(){\n        document.body.scrollTop = 0\n    },200)\n}else{\n    document.getElementById(&apos;guide&apos;).style.display = &apos;block&apos;\n}\n\n// Forward To Redirect Url\n// Add by zhanzhixiang 12/28/2015\nif (params.redirect) {\n    var redirectUrl = decodeURIComponent(params.redirect);\n    if ( typeof(URL) === &apos;function&apos; &amp;&amp; new URL(redirectUrl).hostname.search(&quot;163.com&quot;) !== -1) {\n        window.location.href = redirectUrl;\n    } else if (redirectUrl.search(&quot;163.com&quot;) !== -1){\n        window.location.href = redirectUrl;\n    };\n}\n\n// Forward To Redirect Url End\nif ((isWeixin || isQQ) &amp;&amp; isAndroid) {\n    window.location.href = &apos;http://a.app.qq.com/o/simple.jsp?pkgname=com.netease.newsreader.activity&amp;ckey=CK1331205846719&amp;android_schema=&apos; +　url.match(/(.*)\\?/)[1]\n}\n\nif(isIos||isIpad){\n    document.getElementById(&quot;guide&quot;).classList.add(&apos;iosguideopen&apos;)\n}else if (isAndroid){\n    document.getElementById(&quot;guide&quot;).classList.add(&apos;androidguideopen&apos;)\n}else{\n    // window.location.href = &apos;http://www.163.com/newsapp&apos;\n}\n\ndocument.getElementById(&apos;link&apos;).addEventListener(&apos;click&apos;, function(){\n\n    // 统计\n    neteaseTracker &amp;&amp; neteaseTracker(false,&apos;http://sps.163.com/func/?func=downloadapp&amp;modelid=&apos;+modelid+&apos;&amp;spst=&apos;+spst+&apos;&amp;spsf&amp;spss=&apos; + channel,&apos;&apos;, &apos;sps&apos; )\n\n    if (config) {\n        android_url = config.android\n    }\n    if (config &amp;&amp; config.iOS) {\n        ios_url = config.iOS\n    }\n    if(isWeixin || isQQ){\n        return\n    }\n    var msg = isIDeviceIpad ? &quot;检测到您正在使用iPad, 是否直接前往AppStore下载?&quot; : &quot;检测到您正在使用iPhone, 是否直接前往AppStore下载?&quot;;\n    if (isIDevice){\n        window.location = ios_url;\n        return;\n    }else if(isAndroid){\n        // uc浏览器用iframe唤醒\n        if(navigator.userAgent.match(/ucbrowser|yixin|MailMaster/i)){\n            document.getElementById(&apos;iframe&apos;).src = url;\n        } else {\n            window.location.href = url;\n        }\n        setTimeout(function(){\n            if(document.webkitHidden) {\n                return\n            }\n            if (confirm(&quot;检测到您正在使用Android 手机，是否直接下载程序安装包？&quot;)) {\n                neteaseTracker &amp;&amp; neteaseTracker(false,&apos;http://sps.163.com/func/?func=downloadapp_pass&amp;modelid=&apos;+modelid+&apos;&amp;spst=&apos;+spst+&apos;&amp;spsf&amp;spss=&apos; + channel,&apos;&apos;, &apos;sps&apos; )\n                window.location.href = android_url;\n            } else {\n                neteaseTracker &amp;&amp; neteaseTracker(false,&apos;http://sps.163.com/func/?func=downloadapp_cancel&amp;modelid=&apos;+modelid+&apos;&amp;spst=&apos;+spst+&apos;&amp;spsf&amp;spss=&apos; + channel,&apos;&apos;, &apos;sps&apos; )\n            }\n        },200)\n        return;\n    }else if(isIEMobile){\n        window.location = wphone_url;\n        return;\n    }else{\n        window.open(&apos;http://www.163.com/special/00774IQ6/newsapp_download.html&apos;);\n        return;\n    }\n}, false)\n\nsetTimeout(function(){\n    if(isIDevice &amp;&amp; params.notdownload != 1 &amp;&amp; !isNewsapp &amp;&amp; !isIos9){\n        document.getElementById(&apos;link&apos;).click()\n    }\n}, 1000)\n</code></pre><p>})(window,document);<br>虽然有一些外部的引用，和一些搞不懂是干什么用的方法和变量，但是基本逻辑还是能够看明白。好像也没有什么特别的地方。研究了许久，看到了一个jsonp请求很奇特。这是来干嘛用的？</p>\n<p>于是费尽千辛万苦，搜索了很多文章，最终锁定了一个关键的名词 Universal links。</p>\n<p>如果我早知道这个名词，那么问题就不会变的那么束手无策。所以这个东西是什么呢？</p>\n<p>Apple为iOS 9发布了一个所谓的通用链接的深层链接特性，即Universal links。虽然它并不完美，但是这一发布，让数以千计的应用开发人员突然意识到自己的应用体验被打破。</p>\n<p>Universal links，一种能够方便的通过传统的HTTP/HTTPS 链接来启动App，使用相同的网址打开网站和App。</p>\n<p>关于这个问题的提问与universal links的介绍 点击这里查看</p>\n<p>ios9推行的一个新的协议！</p>\n<p>关于本文的这个问题，国内的论坛有许许多多的文章来解决，但是提到universal  links的文章少之又少，而我想吐槽的是，我们的ios开发也尼玛不知道这个名词，搞什么鬼。他改变了用户体验的关键在于，微信没有屏蔽这个协议。因此 如果我们的app注册了这个协议，那么我们就能够从微信中直接唤起app。</p>\n<p>这个时候我就发现，上面贴的网易新闻代码中的jsonp请求的内容，就是这个协议必须的一个叫做apple-app-site-association的JSON文件</p>\n<p>{<br>   “applinks”: {<br>       “apps”: [ ],<br>       “details”: {<br>           “TEAM-IDENTIFIER.YOUR.BUNDLE.IDENTIFIER”: {<br>               “paths”: [<br>                   “*”<br>               ]<br>           }<br>       }<br>   }<br>}<br>大家可以直接访问这个链接，查看里面的内容</p>\n<p><a href=\"http://active.163.com/service/form/v1/5847/view/1047.jsonp\">http://active.163.com/service/form/v1/5847/view/1047.jsonp</a></p>\n<p>至于universal links具体如何实现，让ios的同学去搞定吧，这里提供两个参考文章</p>\n<p><a href=\"http://www.cocoachina.com/bbs/read.php?tid-1486368.html\">http://www.cocoachina.com/bbs/read.php?tid-1486368.html</a></p>\n<p><a href=\"https://blog.branch.io/how-to-setup-universal-links-to-deep-link-on-apple-ios-9\">https://blog.branch.io/how-to-setup-universal-links-to-deep-link-on-apple-ios-9</a></p>\n<p>支持了这个协议之后，我们又可以通过iframe来唤起app了，因此基本逻辑就是这样了。最终的调研结果是</p>\n<p>没有完美的解决方案</p>\n<p>就算是网易新闻，这个按钮在使用过程中也会有一些小bug，无法做到完美的状态。</p>\n<p>因为我们面临许多没办法解决的问题，比如无法真正意义上的判断本地是否安装了app，pageshow，pagehide并不是所有的浏览器都支持等。很多其他博客里面，什么计算时间差等方案，根！本！没！有！用！我还花了很久的时间去研究这个方案。</p>\n<p>老实说，从微信中跳转到外部浏览器，并不是一个好的解决方案，这样会导致很多用户流失，因此大家都在ios上实现了universal links，而我更加倾向的方案是知乎的解决，他们从设计上避免了在一个按钮上来判断这个逻辑，而采用了两个按钮的方式。</p>\n<p>网易新闻的逻辑是，点击打开会调整到一个下载页面，这个下载页面一加载完成就尝试打开app，如果打开了就直接跑到app里面去了，如果没有就在页面上有一个立即下载的按钮，按钮行只有下载处理。</p>\n<p>这个问题就总结到这里，如果大家有更好的方案，欢迎与我沟通。</p>\n"},{"title":"第一篇测试","date":"2016-09-19T07:06:33.000Z","_content":"\n好事近·汴京赐宴闻教坊乐有感\n朝代：宋代\n\n作者：韩元吉\n\n原文：\n凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。\n杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 ","source":"_posts/第一篇测试.md","raw":"---\ntitle: 第一篇测试\ndate: 2016-09-19 15:06:33\ntags:\n---\n\n好事近·汴京赐宴闻教坊乐有感\n朝代：宋代\n\n作者：韩元吉\n\n原文：\n凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。\n杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 ","slug":"第一篇测试","published":1,"updated":"2016-09-19T07:37:46.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"citb6ip990003z98zpcpwww9d","content":"<p>好事近·汴京赐宴闻教坊乐有感<br>朝代：宋代</p>\n<p>作者：韩元吉</p>\n<p>原文：<br>凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。<br>杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 </p>\n","excerpt":"","more":"<p>好事近·汴京赐宴闻教坊乐有感<br>朝代：宋代</p>\n<p>作者：韩元吉</p>\n<p>原文：<br>凝碧旧池头，一听管弦凄切。多少梨园声在，总不堪华发。<br>杏花无处避春愁，也傍野烟发。惟有御沟声断，似知人呜咽。 </p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}